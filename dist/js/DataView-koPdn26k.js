var tt=Object.defineProperty;var at=(h,t,e)=>t in h?tt(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var te=(h,t,e)=>at(h,typeof t!="symbol"?t+"":t,e);import{_ as he}from"./_plugin-vue_export-helper-DktIPzqB.js";import{e as st,f as z,g as G,d as fe,h as _e,c as Q,o as C,i as w,a as r,j as ye,w as o,k as ge,l as x,s as be,m as Te,n as Ne,p as ve,q as f,t as we,v as Ze,x as Oe,y as Ie,z as Ae,A as Ue,B as qe,C as W,D as $e,F as Fe,G as d,H as re,I as De,J as Le,K as Me,L as Ee,M as Se,N as Ce,O as Re,P as oe,r as rt,Q as Be,R as Ve,S as He,T as Ke,U as nt,V as ot,W as lt,X as it,Y as Je,Z as ct,_ as xe,$ as ut,a0 as dt,a1 as ht,a2 as ft,a3 as pt,a4 as gt,a5 as mt,a6 as St}from"./index-X85zERS4.js";var J=(h=>(h.EASTMONEY="eastmoney",h.SSE="sse",h.SZSE="szse",h))(J||{}),Z=(h=>(h.SSE="sse",h.SZSE="szse",h.INDICES="indices",h.LIMIT_UP="limitup",h.LIMIT_DOWN="limitdown",h))(Z||{}),k=(h=>(h.NETWORK_ERROR="network_error",h.RATE_LIMIT="rate_limit",h.AUTHENTICATION_ERROR="authentication_error",h.FORBIDDEN="forbidden",h.NOT_FOUND="not_found",h.SERVER_ERROR="server_error",h.TIMEOUT="timeout",h.UNKNOWN_ERROR="unknown_error",h))(k||{});class je{constructor(t={}){te(this,"defaultConfig");te(this,"interceptors");this.defaultConfig={timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"},cache:!0,cacheTTL:5*60*1e3,...t},this.interceptors={request:[],response:[],error:[]}}addRequestInterceptor(t){this.interceptors.request.push(t)}addResponseInterceptor(t){this.interceptors.response.push(t)}addErrorInterceptor(t){this.interceptors.error.push(t)}async get(t,e){const a=this.mergeConfig({method:"GET",...e});return this.request(t,a)}async post(t,e,a){const n=this.mergeConfig({method:"POST",body:e?JSON.stringify(e):void 0,...a});return this.request(t,n)}async put(t,e,a){const n=this.mergeConfig({method:"PUT",body:e?JSON.stringify(e):void 0,...a});return this.request(t,n)}async delete(t,e){const a=this.mergeConfig({method:"DELETE",...e});return this.request(t,a)}async request(t,e){const a=Date.now();try{let n={...e};for(const _ of this.interceptors.request)n=_(n);if(n.cache){const _=this.getCachedData(t,n);if(_)return{success:!0,data:_,message:"缓存数据",status:200,timestamp:Date.now()}}const s={method:n.method||"GET",headers:this.buildHeaders(n.headers),signal:AbortSignal.timeout(n.timeout||this.defaultConfig.timeout||1e4)};n.body&&n.method!=="GET"&&(s.body=n.body);const i=this.buildUrl(t,n.params),u=await fetch(i,s);if(!u.ok)throw new Error(`HTTP ${u.status}: ${u.statusText}`);let l;const v=u.headers.get("content-type");if(v?.includes("application/json"))l=await u.json();else if(v?.includes("text")){const _=await u.text();if(_.includes("jQuery")||_.includes("callback")){const K=_.match(/\((.*)\)/);if(K)try{l=JSON.parse(K[1])}catch{l=_}else l=_}else l=_}else l=await u.blob();for(const _ of this.interceptors.response)l=_(l);n.cache&&n.cacheTTL&&this.setCachedData(t,l,n.cacheTTL);const ae=Date.now()-a;return{success:!0,data:l,message:"请求成功",status:u.status,timestamp:Date.now()}}catch(n){let s=n;for(const i of this.interceptors.error)try{s=i(s)}catch(u){console.warn("Error interceptor failed:",u)}return{success:!1,data:null,message:s.message||"请求失败",status:s.status||500,errorType:this.classifyError(s),originalError:s.stack||s.message,timestamp:Date.now()}}}mergeConfig(t){return{...this.defaultConfig,...t,headers:{...this.defaultConfig.headers,...t.headers},params:{...this.defaultConfig.params,...t.params}}}buildHeaders(t){const e=new Headers;return Object.entries({"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"}).forEach(([n,s])=>{e.append(n,s)}),t&&Object.entries(t).forEach(([n,s])=>{e.append(n,s)}),e}buildUrl(t,e){if(!e||Object.keys(e).length===0)return t;const a=new URL(t);return Object.entries(e).forEach(([n,s])=>{s!=null&&a.searchParams.append(n,String(s))}),a.toString()}extractHeaders(t){const e={};return t.headers.forEach((a,n)=>{e[n]=a}),e}classifyError(t){if(!t)return k.UNKNOWN_ERROR;const e=t.message?.toLowerCase()||"",a=t.status||t.response?.status;if(a){if(a===429)return k.RATE_LIMIT;if(a===401||a===403)return k.AUTHENTICATION_ERROR;if(a===404)return k.NOT_FOUND;if(a>=500)return k.SERVER_ERROR;if(a>=400)return k.FORBIDDEN}return e.includes("timeout")||e.includes("aborted")?k.TIMEOUT:e.includes("network")||e.includes("fetch")?k.NETWORK_ERROR:e.includes("rate limit")||e.includes("too many requests")?k.RATE_LIMIT:e.includes("unauthorized")||e.includes("forbidden")?k.AUTHENTICATION_ERROR:e.includes("cors")?k.FORBIDDEN:k.UNKNOWN_ERROR}getCachedData(t,e){if(typeof window>"u")return null;try{const a=`api_cache_${btoa(t)}`,n=localStorage.getItem(a);if(!n)return null;const{data:s,timestamp:i,ttl:u}=JSON.parse(n);return Date.now()-i>(u||e.cacheTTL||this.defaultConfig.cacheTTL||3e5)?(localStorage.removeItem(a),null):s}catch(a){return console.warn("Failed to get cached data:",a),null}}setCachedData(t,e,a){if(!(typeof window>"u"))try{const n=`api_cache_${btoa(t)}`,s={data:e,timestamp:Date.now(),ttl:a};localStorage.setItem(n,JSON.stringify(s))}catch(n){console.warn("Failed to cache data:",n)}}clearCache(t){if(!(typeof window>"u"))try{const a=Object.keys(localStorage).filter(n=>n.startsWith("api_cache_"));for(const n of a)(!t||n.includes(t))&&localStorage.removeItem(n)}catch(e){console.warn("Failed to clear cache:",e)}}setDefaultConfig(t){this.defaultConfig={...this.defaultConfig,...t}}getDefaultConfig(){return{...this.defaultConfig}}}class ze{constructor(t={}){te(this,"config");te(this,"memoryCache",new Map);te(this,"dbName","StockDataCache");te(this,"dbVersion",1);te(this,"dbStoreName","cache");this.config={enabled:!0,ttl:30*60*1e3,storage:"localStorage",keyPrefix:"stock_data_",maxEntries:1e3,...t},this.startCleanupTimer()}async set(t,e,a){if(!this.config.enabled)return;const n=this.getFullKey(t),s=Date.now(),i=a||this.config.ttl,u=s+i,l=this.calculateSize(e),v={data:e,timestamp:s,expiresAt:u,accessCount:0,lastAccessTime:s,size:l};try{switch(this.config.storage){case"localStorage":await this.setLocalStorage(n,v);break;case"indexedDB":await this.setIndexedDB(n,v);break;case"memory":this.setMemory(n,v);break}await this.enforceCapacityLimit()}catch(V){console.warn("Failed to set cache:",V)}}async get(t){if(!this.config.enabled)return null;const e=this.getFullKey(t);try{let a=null;switch(this.config.storage){case"localStorage":a=await this.getLocalStorage(e);break;case"indexedDB":a=await this.getIndexedDB(e);break;case"memory":a=this.getMemory(e);break}return a?Date.now()>a.expiresAt?(await this.delete(t),null):(a.accessCount++,a.lastAccessTime=Date.now(),this.config.storage!=="indexedDB"&&await this.updateAccessInfo(e,a),a.data):null}catch(a){return console.warn("Failed to get cache:",a),null}}async delete(t){if(!this.config.enabled)return;const e=this.getFullKey(t);try{switch(this.config.storage){case"localStorage":localStorage.removeItem(e);break;case"indexedDB":await this.deleteIndexedDB(e);break;case"memory":this.memoryCache.delete(e);break}}catch(a){console.warn("Failed to delete cache:",a)}}async exists(t){return await this.get(t)!==null}async clear(){if(this.config.enabled)try{switch(this.config.storage){case"localStorage":await this.clearLocalStorage();break;case"indexedDB":await this.clearIndexedDB();break;case"memory":this.memoryCache.clear();break}}catch(t){console.warn("Failed to clear cache:",t)}}async clearExpired(){if(this.config.enabled)try{switch(this.config.storage){case"localStorage":await this.clearExpiredLocalStorage();break;case"indexedDB":await this.clearExpiredIndexedDB();break;case"memory":await this.clearExpiredMemory();break}}catch(t){console.warn("Failed to clear expired cache:",t)}}async getStats(){if(!this.config.enabled)return{totalEntries:0,hits:0,misses:0,hitRate:0,cacheSize:0,expiredEntries:0};try{let t=0,e=0,a=0;switch(this.config.storage){case"localStorage":({totalEntries:t,cacheSize:e,expiredEntries:a}=await this.getLocalStorageStats());break;case"indexedDB":({totalEntries:t,cacheSize:e,expiredEntries:a}=await this.getIndexedDBStats());break;case"memory":({totalEntries:t,cacheSize:e,expiredEntries:a}=this.getMemoryStats());break}const n=0,s=0,i=n+s>0?n/(n+s)*100:0;return{totalEntries:t,hits:n,misses:s,hitRate:i,cacheSize:e,expiredEntries:a}}catch(t){return console.warn("Failed to get cache stats:",t),{totalEntries:0,hits:0,misses:0,hitRate:0,cacheSize:0,expiredEntries:0}}}async setLocalStorage(t,e){localStorage.setItem(t,JSON.stringify(e))}async getLocalStorage(t){const e=localStorage.getItem(t);return e?JSON.parse(e):null}async clearLocalStorage(){Object.keys(localStorage).filter(a=>a.startsWith(this.config.keyPrefix)).forEach(a=>localStorage.removeItem(a))}async clearExpiredLocalStorage(){const t=Object.keys(localStorage),e=Date.now();for(const a of t)if(a.startsWith(this.config.keyPrefix))try{const n=JSON.parse(localStorage.getItem(a)||"{}");n.expiresAt&&e>n.expiresAt&&localStorage.removeItem(a)}catch{localStorage.removeItem(a)}}async getLocalStorageStats(){const e=Object.keys(localStorage).filter(u=>u.startsWith(this.config.keyPrefix));let a=e.length,n=0,s=0;const i=Date.now();for(const u of e)try{const l=localStorage.getItem(u);if(l){n+=new Blob([l]).size;const v=JSON.parse(l);v.expiresAt&&i>v.expiresAt&&s++}}catch{s++}return{totalEntries:a,cacheSize:n,expiredEntries:s}}async openIndexedDB(){return new Promise((t,e)=>{const a=indexedDB.open(this.dbName,this.dbVersion);a.onerror=()=>e(a.error),a.onsuccess=()=>t(a.result),a.onupgradeneeded=()=>{const n=a.result;n.objectStoreNames.contains(this.dbStoreName)||n.createObjectStore(this.dbStoreName,{keyPath:"key"}).createIndex("expiresAt","expiresAt",{unique:!1})}})}async setIndexedDB(t,e){const a=await this.openIndexedDB();return new Promise((n,s)=>{const l=a.transaction([this.dbStoreName],"readwrite").objectStore(this.dbStoreName).put({key:t,...e});l.onerror=()=>s(l.error),l.onsuccess=()=>n()})}async getIndexedDB(t){const e=await this.openIndexedDB();return new Promise((a,n)=>{const u=e.transaction([this.dbStoreName],"readonly").objectStore(this.dbStoreName).get(t);u.onerror=()=>n(u.error),u.onsuccess=()=>{const l=u.result;if(l){const{key:v,...V}=l;a(V)}else a(null)}})}async deleteIndexedDB(t){const e=await this.openIndexedDB();return new Promise((a,n)=>{const u=e.transaction([this.dbStoreName],"readwrite").objectStore(this.dbStoreName).delete(t);u.onerror=()=>n(u.error),u.onsuccess=()=>a()})}async clearIndexedDB(){const t=await this.openIndexedDB();return new Promise((e,a)=>{const i=t.transaction([this.dbStoreName],"readwrite").objectStore(this.dbStoreName).clear();i.onerror=()=>a(i.error),i.onsuccess=()=>e()})}async clearExpiredIndexedDB(){const t=await this.openIndexedDB();return new Promise((e,a)=>{const i=t.transaction([this.dbStoreName],"readwrite").objectStore(this.dbStoreName).index("expiresAt"),u=Date.now(),l=i.openCursor(IDBKeyRange.upperBound(u));l.onerror=()=>a(l.error),l.onsuccess=v=>{const V=v.target.result;V?(V.delete(),V.continue()):e()}})}async getIndexedDBStats(){const t=await this.openIndexedDB();return new Promise(e=>{const s=t.transaction([this.dbStoreName],"readonly").objectStore(this.dbStoreName).getAll();s.onsuccess=()=>{const i=s.result,u=i.length;let l=0,v=0;const V=Date.now();for(const ae of i)l+=JSON.stringify(ae).length,ae.expiresAt&&V>ae.expiresAt&&v++;e({totalEntries:u,cacheSize:l,expiredEntries:v})}})}setMemory(t,e){this.memoryCache.set(t,e)}getMemory(t){return this.memoryCache.get(t)||null}async clearExpiredMemory(){const t=Date.now(),e=[];for(const[a,n]of this.memoryCache.entries())t>n.expiresAt&&e.push(a);e.forEach(a=>this.memoryCache.delete(a))}getMemoryStats(){let t=this.memoryCache.size,e=0,a=0;const n=Date.now();for(const s of this.memoryCache.values())e+=s.size,n>s.expiresAt&&a++;return{totalEntries:t,cacheSize:e,expiredEntries:a}}getFullKey(t){return`${this.config.keyPrefix}${t}`}calculateSize(t){try{return new Blob([JSON.stringify(t)]).size}catch{return 0}}async updateAccessInfo(t,e){if(this.config.storage!=="indexedDB")switch(this.config.storage){case"localStorage":await this.setLocalStorage(t,e);break;case"memory":this.setMemory(t,e);break}}async enforceCapacityLimit(){if(!this.config.maxEntries)return;const t=await this.getStats();if(t.totalEntries<=this.config.maxEntries)return;const e=[];switch(this.config.storage){case"localStorage":await this.getLocalStorageItemsForEviction(e);break;case"indexedDB":await this.getIndexedDBItemsForEviction(e);break;case"memory":this.getMemoryItemsForEviction(e);break}e.sort((n,s)=>n.lastAccessTime-s.lastAccessTime);const a=e.slice(0,t.totalEntries-this.config.maxEntries);for(const n of a)await this.delete(n.key.replace(this.config.keyPrefix,""))}async getLocalStorageItemsForEviction(t){const e=Object.keys(localStorage);for(const a of e)if(a.startsWith(this.config.keyPrefix))try{const n=JSON.parse(localStorage.getItem(a)||"{}");t.push({key:a,lastAccessTime:n.lastAccessTime||0})}catch{}}async getIndexedDBItemsForEviction(t){const e=await this.openIndexedDB();return new Promise(a=>{const i=e.transaction([this.dbStoreName],"readonly").objectStore(this.dbStoreName).getAll();i.onsuccess=()=>{i.result.forEach(u=>{t.push({key:u.key,lastAccessTime:u.lastAccessTime||0})}),a()}})}getMemoryItemsForEviction(t){for(const[e,a]of this.memoryCache.entries())t.push({key:e,lastAccessTime:a.lastAccessTime})}startCleanupTimer(){setInterval(()=>{this.clearExpired().catch(t=>{console.warn("Cache cleanup failed:",t)})},60*60*1e3)}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class Pe{constructor(t){te(this,"config");te(this,"stats");te(this,"health");this.config=t,this.stats={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastRequestTime:0},this.health={isHealthy:!0,lastCheckTime:Date.now(),consecutiveFailures:0}}get name(){return this.config.name}get type(){return this.config.type}get configuration(){return{...this.config}}get isHealthy(){return this.health.isHealthy&&this.config.enabled}getStats(){const t=this.stats.totalRequests>0?this.stats.successfulRequests/this.stats.totalRequests*100:0;return{name:this.config.name,isHealthy:this.health.isHealthy,lastCheckTime:new Date(this.health.lastCheckTime).toISOString(),successRate:t,averageResponseTime:this.stats.averageResponseTime,errorCount:this.stats.failedRequests,totalRequests:this.stats.totalRequests,lastError:this.health.lastError}}resetStats(){this.stats={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastRequestTime:0}}async handleRequest(t,e=k.UNKNOWN_ERROR){const a=Date.now();this.stats.totalRequests++,this.stats.lastRequestTime=a;try{const n=await t(),i=Date.now()-a;return this.stats.successfulRequests++,this.updateAverageResponseTime(i),this.updateHealthStatus(!0),{success:!0,data:n,message:"数据获取成功",status:200,timestamp:Date.now()}}catch(n){const i=Date.now()-a;this.stats.failedRequests++,this.updateAverageResponseTime(i),this.updateHealthStatus(!1,n.message);const u=this.classifyError(n,e);return{success:!1,data:null,message:n.message||"数据获取失败",status:n.status||500,errorType:u,originalError:n.stack||n.message,timestamp:Date.now()}}}updateAverageResponseTime(t){this.stats.averageResponseTime===0?this.stats.averageResponseTime=t:this.stats.averageResponseTime=.1*t+(1-.1)*this.stats.averageResponseTime}updateHealthStatus(t,e){this.health.lastCheckTime=Date.now(),t?(this.health.consecutiveFailures=0,this.health.lastError=void 0,this.health.isHealthy=!0):(this.health.consecutiveFailures++,this.health.lastError=e,this.health.consecutiveFailures>=3&&(this.health.isHealthy=!1))}classifyError(t,e){if(!t)return e;const a=t.message?.toLowerCase()||"",n=t.status||t.response?.status;if(n){if(n===429)return k.RATE_LIMIT;if(n===401||n===403)return k.AUTHENTICATION_ERROR;if(n===404)return k.NOT_FOUND;if(n>=500)return k.SERVER_ERROR;if(n>=400)return k.FORBIDDEN}return a.includes("timeout")?k.TIMEOUT:a.includes("network")||a.includes("fetch")?k.NETWORK_ERROR:a.includes("rate limit")||a.includes("too many requests")?k.RATE_LIMIT:a.includes("unauthorized")||a.includes("forbidden")?k.AUTHENTICATION_ERROR:e}buildUrl(t,e,a){const n=new URL(e,t);return a&&Object.entries(a).forEach(([s,i])=>{i!=null&&n.searchParams.append(s,String(i))}),n.toString()}buildHeaders(t){return{Accept:"application/json","Content-Type":"application/json",...this.config.requestConfig?.headers,...t}}validateDate(t){return/^\d{4}-\d{2}-\d{2}$/.test(t)&&!isNaN(Date.parse(t))}getRandomDelay(t,e){return Math.random()*(e-t)+t}sleep(t){return new Promise(e=>setTimeout(e,t))}}class Xe extends Pe{constructor(e){super({...{name:"EastMoney",type:"eastmoney",baseUrl:"http://push2.eastmoney.com",enabled:!0,priority:1,requestConfig:{timeout:1e4,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:"http://quote.eastmoney.com/"}}},...e});te(this,"endpoints",{sseData:"http://push2.eastmoney.com/api/qt/clist/get",szseData:"http://9.push2.eastmoney.com/api/qt/clist/get",indexData:"http://push2.eastmoney.com/api/qt/stock/get",stockDetail:"http://push2.eastmoney.com/api/qt/stock/details/get",limitData:"http://push2.eastmoney.com/api/qt/clist/get",timeData:"http://push2.eastmoney.com/api/qt/stock/trends2/get"})}async getSSEData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={cb:`jQuery_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,pn:1,pz:5e3,po:1,np:1,ut:"bd1d9ddb04089700cf9c27f6f7426281",fltt:2,invt:2,fid:"f3",fs:"m:0+t:6,m:0+t:80,m:1+t:2,m:1+t:23",fields:"f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152"},s=this.buildUrl(this.endpoints.sseData,"",n),i=await this.fetchData(s,a);return this.parseStockDataResponse(i,e)}):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getSZSEData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={cb:`jQuery_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,pn:1,pz:5e3,po:1,np:1,ut:"bd1d9ddb04089700cf9c27f6f7426281",fltt:2,invt:2,fid:"f3",fs:"m:0+t:6,m:0+t:81,m:1+t:2,m:1+t:23,m:0+t:81+s:2048",fields:"f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152"},s=this.buildUrl(this.endpoints.szseData,"",n),i=await this.fetchData(s,a);return this.parseStockDataResponse(i,e)}):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getIndexData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={cb:`jQuery_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,fields:"f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f26,f22,f33,f11,f62,f128,f136,f115,f152",secids:"1.000001,1.000002,1.000300,1.000905,1.000688,1.000016,0.399001,0.399005,0.399006"},s=this.buildUrl(this.endpoints.indexData,"",n),i=await this.fetchData(s,a);return this.parseIndexDataResponse(i,e)}):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getLimitUpData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={cb:`jQuery_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,pn:1,pz:5e3,po:1,np:1,ut:"bd1d9ddb04089700cf9c27f6f7426281",fltt:2,invt:2,fid:"f3",fs:"m:0+t:6,m:0+t:80,m:1+t:2,m:1+t:23",fields:"f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152"},s=this.buildUrl(this.endpoints.limitData,"",n),i=await this.fetchData(s,a),u=this.parseStockDataResponse(i,e);if(Array.isArray(u)){const l=u.filter(v=>v.chg_rate>=9.9);return{success:!0,data:{fetchDate:new Date().toISOString(),exchange:"LIMITUP",date:e,data:l},message:`获取到${l.length}只涨停股票`,status:200,timestamp:Date.now()}}return{success:!0,data:u,message:"获取涨停股票数据成功",status:200,timestamp:Date.now()}}):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getLimitDownData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={cb:`jQuery_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,pn:1,pz:5e3,po:1,np:1,ut:"bd1d9ddb04089700cf9c27f6f7426281",fltt:2,invt:2,fid:"f3",fs:"m:0+t:6,m:0+t:80,m:1+t:2,m:1+t:23",fields:"f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152"},s=this.buildUrl(this.endpoints.limitData,"",n),i=await this.fetchData(s,a),u=this.parseStockDataResponse(i,e);if(Array.isArray(u)){const l=u.filter(v=>v.chg_rate<=-9.9);return{success:!0,data:{fetchDate:new Date().toISOString(),exchange:"LIMITDOWN",date:e,data:l},message:`获取到${l.length}只跌停股票`,status:200,timestamp:Date.now()}}return{success:!0,data:u,message:"获取跌停股票数据成功",status:200,timestamp:Date.now()}}):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async healthCheck(){try{return(await this.getIndexData(new Date().toISOString().split("T")[0])).success}catch{return!1}}async fetchData(e,a){const n=this.buildHeaders(a?.headers),s=await fetch(e,{method:"GET",headers:n,signal:AbortSignal.timeout(a?.timeout||this.config.requestConfig?.timeout||1e4)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const i=await s.text();if(i.includes("jQuery")){const u=i.match(/\((.*)\)/);if(u)return JSON.parse(u[1])}return JSON.parse(i)}parseStockDataResponse(e,a){if(!e||!e.data||!e.data.diff)throw new Error("无效的响应数据格式");const n=e.data.diff.map(s=>({code:s.f12,name:s.f14,open:this.parseNumber(s.f17),high:this.parseNumber(s.f15),low:this.parseNumber(s.f16),last:this.parseNumber(s.f2),prev_close:this.parseNumber(s.f18),change:this.parseNumber(s.f4),chg_rate:this.parseNumber(s.f3),volume:this.parseNumber(s.f5),amount:this.parseNumber(s.f6),tradephase:s.f122||"",amp_rate:this.parseNumber(s.f7),cpxxsubtype:this.parseString(s.f104),cpxxprodusta:this.parseString(s.f105)}));return{fetchDate:new Date().toISOString(),date:a,data:n}}parseIndexDataResponse(e,a){if(!e||!e.data)throw new Error("无效的响应数据格式");const n=e.data.map(s=>({code:s.f12,name:s.f14,current:this.parseNumber(s.f2),change:this.parseNumber(s.f4),chg_rate:this.parseNumber(s.f3),open:this.parseNumber(s.f17),high:this.parseNumber(s.f15),low:this.parseNumber(s.f16),volume:this.parseNumber(s.f5),amount:this.parseNumber(s.f6),prev_close:this.parseNumber(s.f18),update_time:this.parseString(s.f168)||new Date().toISOString()}));return{fetchDate:new Date().toISOString(),date:a,data:n}}parseNumber(e){return e==null||e==="-"?0:parseFloat(e)||0}parseString(e){return e==null?"":String(e)}}class Ge extends Pe{constructor(e){super({...{name:"SSE",type:"sse",baseUrl:"http://query.sse.com.cn",enabled:!0,priority:2,requestConfig:{timeout:15e3,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:"http://www.sse.com.cn/",Accept:"application/json, text/javascript, */*; q=0.01","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8",Connection:"keep-alive"}}},...e});te(this,"endpoints",{stockList:"http://query.sse.com.cn/commonQuery.do",realtimeData:"http://query.sse.com.cn/commonQuery.do",historyData:"http://query.sse.com.cn/commonQuery.do",indexData:"http://query.sse.com.cn/commonQuery.do",marketData:"http://query.sse.com.cn/commonQuery.do"})}async getSSEData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={jsonCallBack:`jsonpCallback${Date.now()}`,isPagination:"false",sqlId:"COMMON_SSE_XXPL_LB_GSXX_L",pageHelp:{begin:0,end:9999,pageSize:1e3},_:Date.now()},s=this.buildUrl(this.endpoints.stockList,"",n),i=await this.fetchSSEData(s,a);return this.parseSSEStockData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getSZSEData(e,a){return{success:!1,data:{fetchDate:new Date().toISOString(),date:e,data:[]},message:"上交所数据源不提供深交所数据",status:200,errorType:k.NOT_FOUND,timestamp:Date.now()}}async getIndexData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={jsonCallBack:`jsonpCallback${Date.now()}`,isPagination:"false",sqlId:"COMMON_SSE_XXPL_ZSXX_L",_:Date.now()},s=this.buildUrl(this.endpoints.indexData,"",n),i=await this.fetchSSEData(s,a);return this.parseSSEIndexData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getLimitUpData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={jsonCallBack:`jsonpCallback${Date.now()}`,isPagination:"false",sqlId:"COMMON_SSE_XXPL_ZTXX_L",pageHelp:{begin:0,end:9999,pageSize:1e3},_:Date.now()},s=this.buildUrl(this.endpoints.marketData,"",n),i=await this.fetchSSEData(s,a);return this.parseSSEStockData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getLimitDownData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={jsonCallBack:`jsonpCallback${Date.now()}`,isPagination:"false",sqlId:"COMMON_SSE_XXPL_DTXX_L",pageHelp:{begin:0,end:9999,pageSize:1e3},_:Date.now()},s=this.buildUrl(this.endpoints.marketData,"",n),i=await this.fetchSSEData(s,a);return this.parseSSEStockData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async healthCheck(){try{return(await this.getSSEData(new Date().toISOString().split("T")[0])).success}catch{return!1}}async fetchSSEData(e,a){const n=this.buildHeaders(a?.headers),s=await fetch(e,{method:"GET",headers:n,signal:AbortSignal.timeout(a?.timeout||this.config.requestConfig?.timeout||15e3),mode:"cors",credentials:"omit"});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const i=await s.text();if(i.includes("jsonpCallback")){const u=i.match(/jsonpCallback\d+\((.*)\)/);if(u)return JSON.parse(u[1])}throw new Error("无法解析上交所API响应")}parseSSEStockData(e,a){if(!e||!e.result)throw new Error("无效的上交所响应数据格式");const n=e.result.map(s=>({code:s.ACCOUNT_CODE||s.STOCK_CODE||"",name:s.SECURITY_NAME_ABBR||s.STOCK_NAME||"",open:this.parseNumber(s.OPEN_PRICE),high:this.parseNumber(s.HIGH_PRICE),low:this.parseNumber(s.LOW_PRICE),last:this.parseNumber(s.NEW_PRICE||s.CURRENT_PRICE),prev_close:this.parseNumber(s.PRE_CLOSE_PRICE),change:this.parseNumber(s.CHANGE_AMOUNT),chg_rate:this.parseNumber(s.CHANGE_RATE),volume:this.parseNumber(s.TRADE_VOLUME),amount:this.parseNumber(s.TRADE_AMOUNT),tradephase:s.TRADE_STATUS||"正常",amp_rate:this.parseNumber(s.AMPLITUDE),cpxxsubtype:s.PRODUCT_TYPE||"ASH",cpxxprodusta:s.LISTING_STATUS||"   D  F  N          "}));return{fetchDate:new Date().toISOString(),date:a,data:n}}parseSSEIndexData(e,a){if(!e||!e.result)throw new Error("无效的上交所指数响应数据格式");const n=e.result.map(s=>({code:s.INDEX_CODE||"",name:s.INDEX_NAME||"",current:this.parseNumber(s.NEW_PRICE||s.CURRENT_INDEX),change:this.parseNumber(s.CHANGE_AMOUNT),chg_rate:this.parseNumber(s.CHANGE_RATE),open:this.parseNumber(s.OPEN_INDEX),high:this.parseNumber(s.HIGH_INDEX),low:this.parseNumber(s.LOW_INDEX),volume:this.parseNumber(s.TRADE_VOLUME),amount:this.parseNumber(s.TRADE_AMOUNT),prev_close:this.parseNumber(s.PRE_CLOSE_INDEX),update_time:s.UPDATE_TIME||new Date().toISOString()}));return{fetchDate:new Date().toISOString(),date:a,data:n}}parseNumber(e){if(e==null||e===""||e==="-")return 0;const a=String(e).replace(/,/g,"").trim(),n=parseFloat(a);return isNaN(n)?0:n}buildSSEUrl(e,a){const n=new URL(e);return Object.entries(a).forEach(([s,i])=>{i!=null&&(typeof i=="object"?n.searchParams.append(s,JSON.stringify(i)):n.searchParams.append(s,String(i)))}),n.toString()}buildUrl(e,a,n){const s=a?`${e.replace(/\/$/,"")}/${a.replace(/^\//,"")}`:e;return this.buildSSEUrl(s,n||{})}}class Qe extends Pe{constructor(e){super({...{name:"SZSE",type:"szse",baseUrl:"http://www.szse.cn",enabled:!0,priority:3,requestConfig:{timeout:15e3,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:"http://www.szse.cn/",Accept:"application/json, text/javascript, */*; q=0.01","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8",Connection:"keep-alive","X-Requested-With":"XMLHttpRequest"}}},...e});te(this,"endpoints",{stockList:"http://www.szse.cn/api/report/ShowReport/data",realtimeData:"http://www.szse.cn/api/report/ShowReport/data",historyData:"http://www.szse.cn/api/report/ShowReport/data",indexData:"http://www.szse.cn/api/report/ShowReport/data",marketStats:"http://www.szse.cn/api/report/ShowReport/data"})}async getSSEData(e,a){return{success:!1,data:{fetchDate:new Date().toISOString(),date:e,data:[]},message:"深交所数据源不提供上交所数据",status:200,errorType:k.NOT_FOUND,timestamp:Date.now()}}async getSZSEData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={SHOWTYPE:"JSON",TABCAT:"1215",CAT:"DYB",SEC_CODE:"",SEC_NAME:"",_:Date.now()},s=this.buildUrl(this.endpoints.stockList,"",n),i=await this.fetchSZSEData(s,a);return this.parseSZSEStockData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getIndexData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={SHOWTYPE:"JSON",TABCAT:"1210",CAT:"ZB",_:Date.now()},s=this.buildUrl(this.endpoints.indexData,"",n),i=await this.fetchSZSEData(s,a);return this.parseSZSEIndexData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getLimitUpData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={SHOWTYPE:"JSON",TABCAT:"1215",CAT:"ZT",_:Date.now()},s=this.buildUrl(this.endpoints.marketStats,"",n),i=await this.fetchSZSEData(s,a);return this.parseSZSEStockData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async getLimitDownData(e,a){return this.validateDate(e)?this.handleRequest(async()=>{const n={SHOWTYPE:"JSON",TABCAT:"1215",CAT:"DT",_:Date.now()},s=this.buildUrl(this.endpoints.marketStats,"",n),i=await this.fetchSZSEData(s,a);return this.parseSZSEStockData(i,e)},k.NETWORK_ERROR):{success:!1,data:null,message:"无效的日期格式，请使用YYYY-MM-DD格式",status:400,errorType:k.UNKNOWN_ERROR,timestamp:Date.now()}}async healthCheck(){try{return(await this.getSZSEData(new Date().toISOString().split("T")[0])).success}catch{return!1}}async fetchSZSEData(e,a){const n=this.buildHeaders(a?.headers),s=await fetch(e,{method:"GET",headers:n,signal:AbortSignal.timeout(a?.timeout||this.config.requestConfig?.timeout||15e3),mode:"cors",credentials:"omit"});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const i=await s.text();if(i.includes("callback")){const u=i.match(/callback\d+\((.*)\)/);if(u)return JSON.parse(u[1])}try{return JSON.parse(i)}catch{throw new Error("无法解析深交所API响应")}}parseSZSEStockData(e,a){if(!e||!e.data)throw new Error("无效的深交所响应数据格式");const n=e.data.map(s=>({code:s.zqdm||s.gsdm||"",name:s.mc||s.gsmc||"",open:this.parseNumber(s.kpj),high:this.parseNumber(s.zgj),low:this.parseNumber(s.zdj),last:this.parseNumber(s.zjcj),prev_close:this.parseNumber(s.zs),change:this.parseNumber(s.zde),chg_rate:this.parseNumber(s.zdf),volume:this.parseNumber(s.cjl),amount:this.parseNumber(s.cje),tradephase:s.jyzt||"正常",amp_rate:this.parseNumber(s.zf),cpxxsubtype:s.sslb||"ASH",cpxxprodusta:s.ssgs||"   D  F  N          "}));return{fetchDate:new Date().toISOString(),date:a,data:n}}parseSZSEIndexData(e,a){if(!e||!e.data)throw new Error("无效的深交所指数响应数据格式");const n=e.data.map(s=>({code:s.zqdm||"",name:s.mc||"",current:this.parseNumber(s.zjcj),change:this.parseNumber(s.zde),chg_rate:this.parseNumber(s.zdf),open:this.parseNumber(s.kpj),high:this.parseNumber(s.zgj),low:this.parseNumber(s.zdj),volume:this.parseNumber(s.cjl),amount:this.parseNumber(s.cje),prev_close:this.parseNumber(s.zs),update_time:s.gxsj||new Date().toISOString()}));return{fetchDate:new Date().toISOString(),date:a,data:n}}parseNumber(e){if(e==null||e===""||e==="-")return 0;const a=String(e).replace(/[,]/g,"").trim(),n=parseFloat(a);return isNaN(n)?0:n}buildSZSEUrl(e,a){const n=new URL(e);return Object.entries(a).forEach(([s,i])=>{i!=null&&n.searchParams.append(s,String(i))}),n.toString()}buildUrl(e,a,n){const s=a?`${e.replace(/\/$/,"")}/${a.replace(/^\//,"")}`:e;return this.buildSZSEUrl(s,n||{})}async delayRequest(){const a=Math.random()*500;await this.sleep(1e3+a)}}class _t{constructor(){te(this,"dataSources",new Map);te(this,"primarySource",null);te(this,"fallbackSources",[]);this.initializeDefaultSources()}initializeDefaultSources(){const t=new Xe;this.registerDataSource(t);const e=new Ge;this.registerDataSource(e);const a=new Qe;this.registerDataSource(a),this.setPrimarySource(J.EASTMONEY),this.setFallbackSources([J.SSE,J.SZSE])}registerDataSource(t){this.dataSources.set(t.type,t)}unregisterDataSource(t){this.dataSources.delete(t),this.primarySource?.type===t&&(this.primarySource=null),this.fallbackSources=this.fallbackSources.filter(e=>e.type!==t)}setPrimarySource(t){const e=this.dataSources.get(t);if(e&&e.isHealthy)this.primarySource=e;else throw new Error(`数据源 ${t} 不存在或不可用`)}setFallbackSources(t){this.fallbackSources=[];for(const e of t){const a=this.dataSources.get(e);a&&a.isHealthy&&this.fallbackSources.push(a)}}getDataSource(t){return this.dataSources.get(t)}getAllDataSources(){return Array.from(this.dataSources.values())}getHealthyDataSources(){return Array.from(this.dataSources.values()).filter(t=>t.isHealthy)}getPrimaryDataSource(){return this.primarySource}getFallbackDataSources(){return this.fallbackSources}selectBestDataSource(){const t=this.getHealthyDataSources();return t.length===0?null:this.primarySource&&this.primarySource.isHealthy?this.primarySource:t.sort((a,n)=>{const s=a.configuration,i=n.configuration;return(s.priority||999)-(i.priority||999)})[0]||null}getDataSourceHealth(){return Array.from(this.dataSources.values()).map(t=>t.getStats())}async checkAllDataSourcesHealth(){const t=Array.from(this.dataSources.values()).map(async n=>{try{const s=await n.healthCheck();return{source:n.type,isHealthy:s}}catch(s){return{source:n.type,isHealthy:!1,error:s}}}),e=await Promise.all(t),a=e.find(n=>n.source===this.primarySource?.type);if(a&&!a.isHealthy){console.warn(`主要数据源 ${this.primarySource?.name} 健康检查失败，尝试重新选择`);const n=this.selectBestDataSource();n&&(this.primarySource=n,console.info(`切换到主要数据源: ${n.name}`))}this.fallbackSources=this.fallbackSources.filter(n=>e.find(i=>i.source===n.type)?.isHealthy!==!1)}setDataSourceEnabled(t,e){const a=this.dataSources.get(t);if(a)if(a.configuration.enabled=e,e)this.primarySource?.type!==t&&(this.fallbackSources.some(n=>n.type===t)||this.fallbackSources.push(a));else{if(this.primarySource?.type===t){const n=this.selectBestDataSource();n&&(this.primarySource=n)}this.fallbackSources=this.fallbackSources.filter(n=>n.type!==t)}}configureDataSource(t,e){const a=this.dataSources.get(t);a&&Object.assign(a.configuration,e)}resetAllStats(){this.dataSources.forEach(t=>t.resetStats())}getStatsSummary(){const t=Array.from(this.dataSources.values()),e=t.reduce((i,u)=>i+u.getStats().totalRequests,0),a=t.reduce((i,u)=>{const l=u.getStats(),v=l.totalRequests-l.errorCount;return i+v},0),n=t.reduce((i,u)=>i+u.getStats().errorCount,0),s=t.reduce((i,u)=>i+u.getStats().averageResponseTime,0)/t.length;return{totalDataSources:t.length,healthyDataSources:t.filter(i=>i.isHealthy).length,totalRequests:e,successfulRequests:a,failedRequests:n,successRate:e>0?a/e*100:0,averageResponseTime:s,primarySource:this.primarySource?.name||"none",fallbackSourcesCount:this.fallbackSources.length}}}const le=new _t;class et{constructor(t){te(this,"apiService");te(this,"cacheService");te(this,"requestStats");this.apiService=t?.apiService||new je,this.cacheService=t?.cacheService||new ze,this.requestStats={totalRequests:0,successfulRequests:0,failedRequests:0,requestsBySource:{},lastRequestTime:0},this.setupInterceptors()}async getSSEData(t,e){return this.getData(Z.SSE,t,e)}async getSZSEData(t,e){return this.getData(Z.SZSE,t,e)}async getIndexData(t,e){return this.getData(Z.INDICES,t,e)}async getLimitUpData(t,e){return this.getData(Z.LIMIT_UP,t,e)}async getLimitDownData(t,e){return this.getData(Z.LIMIT_DOWN,t,e)}async batchGetData(t,e){const a=e?.concurrency||3,n=[];for(let s=0;s<t.length;s+=a){const u=t.slice(s,s+a).map(async(l,v)=>{try{const V=await this.getData(l.type,l.date,{useCache:e?.useCache,forceRefresh:e?.forceRefresh,timeout:e?.timeout,retry:e?.retry!==!1});return e?.onProgress&&e.onProgress(s+v+1,t.length),V}catch(V){if(e?.continueOnError)return{success:!1,data:null,message:V.message||"请求失败",status:500,errorType:k.UNKNOWN_ERROR};throw V}});try{const l=await Promise.all(u);n.push(...l)}catch(l){if(!e?.continueOnError)throw l}}return n}async getData(t,e,a){const n=Date.now();this.requestStats.totalRequests++,this.requestStats.lastRequestTime=n;try{if(!a?.forceRefresh&&a?.useCache!==!1){const u=`${t}_${e}_${JSON.stringify(a||{})}`,l=await this.cacheService.get(u);if(l)return this.requestStats.successfulRequests++,{success:!0,data:l,message:"缓存数据",status:200,timestamp:Date.now()}}const s=a?.dataSource?le.getDataSource(a.dataSource):le.selectBestDataSource();if(!s)throw new Error("没有可用的数据源");let i;switch(t){case Z.SSE:i=await s.getSSEData(e,{timeout:a?.timeout});break;case Z.SZSE:i=await s.getSZSEData(e,{timeout:a?.timeout});break;case Z.INDICES:i=await s.getIndexData(e,{timeout:a?.timeout});break;case Z.LIMIT_UP:i=await s.getLimitUpData(e,{timeout:a?.timeout});break;case Z.LIMIT_DOWN:i=await s.getLimitDownData(e,{timeout:a?.timeout});break;default:throw new Error(`不支持的数据类型: ${t}`)}if(this.updateRequestStats(s.name,i.success,Date.now()-n),i.success&&i.data){const u=`${t}_${e}_${JSON.stringify(a||{})}`;await this.cacheService.set(u,i.data,30*60*1e3)}return i}catch(s){return this.requestStats.failedRequests++,this.updateRequestStats("unknown",!1,Date.now()-n),{success:!1,data:null,message:s.message||"数据获取失败",status:500,errorType:this.classifyError(s),originalError:s.stack||s.message,timestamp:Date.now()}}}subscribe(t,e,a){let n=null,s=!0;const i=async()=>{if(s)try{const u=await this.getData(t,e,{useCache:!1});u.success&&u.data&&a.onDataChange(u.data)}catch(u){a.onError(u),a.autoReconnect&&s&&setTimeout(()=>{s&&i()},a.reconnectInterval)}};return i(),n=window.setInterval(i,a.interval),()=>{s=!1,n&&clearInterval(n)}}getDataSourceHealth(){return le.getDataSourceHealth()}getRequestStats(){const t=this.requestStats.totalRequests>0?this.requestStats.successfulRequests/this.requestStats.totalRequests*100:0,e=Object.values(this.requestStats.requestsBySource).reduce((a,n)=>a+n.averageTime,0)/Math.max(1,Object.keys(this.requestStats.requestsBySource).length);return{totalRequests:this.requestStats.totalRequests,successfulRequests:this.requestStats.successfulRequests,failedRequests:this.requestStats.failedRequests,averageResponseTime:e,successRate:t,requestsBySource:this.requestStats.requestsBySource}}async getCacheStats(){return this.cacheService.getStats()}async clearCache(t){t?this.cacheService.clear():await this.cacheService.clear()}configureDataSource(t,e){le.configureDataSource(t,e),e.enabled!==void 0&&le.setDataSourceEnabled(t,e.enabled)}setPrimaryDataSource(t){le.setPrimarySource(t)}setFallbackDataSources(t){le.setFallbackSources(t)}async checkDataSourcesHealth(){await le.checkAllDataSourcesHealth()}resetStats(){this.requestStats={totalRequests:0,successfulRequests:0,failedRequests:0,requestsBySource:{},lastRequestTime:0},le.resetAllStats()}setRequestInterceptor(t){this.apiService.addRequestInterceptor(t)}setResponseInterceptor(t){this.apiService.addResponseInterceptor(t)}setErrorInterceptor(t){this.apiService.addErrorInterceptor(t)}setupInterceptors(){this.apiService.addRequestInterceptor(t=>({...t,headers:{...t.headers,"X-Requested-With":"StockDataService","X-Request-Time":Date.now().toString()}})),this.apiService.addResponseInterceptor(t=>t),this.apiService.addErrorInterceptor(t=>(console.error("API Error:",t),t))}updateRequestStats(t,e,a){this.requestStats.requestsBySource[t]||(this.requestStats.requestsBySource[t]={count:0,successCount:0,averageTime:0});const n=this.requestStats.requestsBySource[t];n.count++,e&&n.successCount++,n.count===1?n.averageTime=a:n.averageTime=.1*a+(1-.1)*n.averageTime}classifyError(t){if(!t)return k.UNKNOWN_ERROR;const e=t.message?.toLowerCase()||"";return e.includes("timeout")||e.includes("aborted")?k.TIMEOUT:e.includes("network")||e.includes("fetch")?k.NETWORK_ERROR:e.includes("rate limit")||e.includes("too many requests")?k.RATE_LIMIT:e.includes("unauthorized")||e.includes("forbidden")?k.AUTHENTICATION_ERROR:k.UNKNOWN_ERROR}async getStockData(t){const e=t.date||new Date().toISOString().split("T")[0];let a;switch(t.exchange.toUpperCase()){case"SSE":a=Z.SSE;break;case"SZSE":a=Z.SZSE;break;default:const[s,i]=await Promise.all([this.getSSEData(e),this.getSZSEData(e)]),u=[];return s.success&&s.data&&u.push(...s.data.data),i.success&&i.data&&u.push(...i.data.data),u}const n=await this.getData(a,e);return n.success?n.data.data||[]:[]}async getMarketStats(t){return{totalStocks:0,limitUpStocks:0,limitDownStocks:0,upStocks:0,downStocks:0,flatStocks:0,timestamp:Date.now()}}getStatus(){return{sources:[],cache:this.getCacheStats(),statistics:this.getRequestStats()}}destroy(){this.resetStats()}}const de={enabled:!0,debug:!1,services:{dataService:{cache:{enabled:!0,ttl:30*60*1e3,storage:"localStorage",keyPrefix:"stock_data_",maxEntries:1e3},apiService:{baseURL:"",timeout:1e4,headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}}},sources:{primary:J.EASTMONEY,fallback:[J.SSE,J.SZSE],custom:[]}};J.EASTMONEY,J.SSE,J.SZSE;J.EASTMONEY+"",J.EASTMONEY,J.SSE+"",J.SSE,J.SZSE+"",J.SZSE;({...de.services,dataService:{...de.services.dataService,cache:{...de.services.dataService.cache}}});const vt={...de,debug:!1,services:{...de.services,dataService:{...de.services.dataService,cache:{...de.services.dataService.cache,ttl:60*60*1e3}}}};function yt(){return vt}function bt(h={}){const t=yt();return{...t,...h,services:{...t.services,...h.services,dataService:{...t.services.dataService,...h.services?.dataService}},sources:{...t.sources,...h.sources}}}Z.SSE+"",Z.SZSE+"",Z.INDICES+"",Z.LIMIT_UP+"",Z.LIMIT_DOWN+"";J.EASTMONEY+"",J.SSE+"",J.SZSE+"";J.EASTMONEY+"",J.SSE+"",J.SZSE+"";J.EASTMONEY+"",J.SSE+"",J.SZSE+"";J.EASTMONEY+"",J.SSE+"",J.SZSE+"";new ze;new je;new Xe;new Ge;new Qe;new et;function wt(h){const t=bt(h),e=new ze(t.services.dataService.cache),a=new je;return new et({apiService:a,cacheService:e})}class Dt{constructor(t){te(this,"service");this.service=wt(t)}async getStockData(t){const e=t.exchange||"ALL",a=t.date||new Date().toISOString().split("T")[0];return this.service.getStockData({exchange:e,date:a})}async getIndexData(t){const e=t?.date||new Date().toISOString().split("T")[0],a=await this.service.getIndexData(e,t);return a.success?a.data.data:[]}async getLimitUpData(t){const e=t?.date||new Date().toISOString().split("T")[0],a=await this.service.getLimitUpData(e,t);return a.success?a.data.data:[]}async getLimitDownData(t){const e=t?.date||new Date().toISOString().split("T")[0],a=await this.service.getLimitDownData(e,t);return a.success?a.data.data:[]}async getMarketStats(t){return this.service.getMarketStats(t)}async batchGetData(t,e){const a=t.map(n=>({type:n.type,date:n.options?.date||new Date().toISOString().split("T")[0]}));return this.service.batchGetData(a,e)}subscribe(t,e){const a=e.date||new Date().toISOString().split("T")[0];return this.service.subscribe(t,a,{interval:e.interval,autoReconnect:e.autoReconnect,reconnectInterval:e.reconnectInterval,onDataChange:e.onDataChange,onError:e.onError})}getStatus(){return this.service.getStatus()}clearCache(t){return this.service.clearCache(t)}}const ue=new Dt;Object.values(J),Object.values(Z);const Et=st("data",()=>{const h=z(new Date().toISOString().split("T")[0]),t=z({sse:!1,szse:!1,limitup:!1,limitdown:!1,indices:!1,marketStats:!1}),e=z(null),a=z(!1),n=z(0),s=z(""),i=z(null),u=z(null),l=z({sse:null,szse:null,limitup:null,limitdown:null,indices:null,marketStats:null}),v=30*60*1e3,V=G(()=>Object.values(t.value).some(S=>S)),ae=G(()=>Object.values(l.value).some(S=>S!==null)),_=G(()=>l.value.sse?.data||[]),K=G(()=>l.value.szse?.data||[]),L=G(()=>l.value.limitup?.data||[]),b=G(()=>l.value.limitdown?.data||[]),P=G(()=>l.value.indices?.data||[]),B=G(()=>l.value.marketStats?.data||null),g=G(()=>{const S=[];return _.value&&S.push(..._.value),K.value&&S.push(...K.value),S}),R=G(()=>{const S=_.value?.length||0,q=K.value?.length||0,U=L.value?.length||0,A=b.value?.length||0,j=P.value?.length||0;return{totalStocks:S+q,sseStocks:S,szseStocks:q,limitUpStocks:U,limitDownStocks:A,indicesCount:j,hasAnyData:ae.value,marketStats:B.value}}),D=S=>S?Date.now()-S.timestamp>v:!0,I=(S,q,U)=>{l.value[S]={data:q,timestamp:Date.now(),date:U}},M=async(S,q)=>{const U=q||h.value;if(!D(l.value[S])&&l.value[S]?.date===U)return console.log(`[${S.toUpperCase()}] 使用缓存数据: ${U}`),!0;try{t.value[S]=!0,e.value=null,console.log(`[${S.toUpperCase()}] 开始获取数据: ${U}`);let A;switch(S){case Z.SSE:A=await ue.getStockData({exchange:"SSE",date:U});break;case Z.SZSE:A=await ue.getStockData({exchange:"SZSE",date:U});break;case Z.LIMIT_UP:A=await ue.getLimitUpData({date:U});break;case Z.LIMIT_DOWN:A=await ue.getLimitDownData({date:U});break;case Z.INDICES:A=await ue.getIndexData({date:U});break;default:throw new Error(`不支持的数据类型: ${S}`)}if(A)return I(S,A,U),console.log(`[${S.toUpperCase()}] 数据获取成功`),!0;throw new Error("获取数据失败")}catch(A){return console.error(`[${S.toUpperCase()}] 获取数据失败:`,A),e.value=A.message||"获取数据失败",!1}finally{t.value[S]=!1}},X=async S=>{const q=S||h.value,U="marketStats";if(!D(l.value[U])&&l.value[U]?.date===q)return console.log(`[MARKET_STATS] 使用缓存数据: ${q}`),!0;try{t.value[U]=!0,e.value=null,console.log(`[MARKET_STATS] 开始获取数据: ${q}`);const A=await ue.getMarketStats({date:q});if(A)return I(U,A,q),console.log("[MARKET_STATS] 数据获取成功"),!0;throw new Error("获取市场统计失败")}catch(A){return console.error("[MARKET_STATS] 获取数据失败:",A),e.value=A.message||"获取市场统计失败",!1}finally{t.value[U]=!1}},Y=async S=>{const q=S||h.value,U=[M(Z.SSE,q),M(Z.SZSE,q),M(Z.LIMIT_UP,q),M(Z.LIMIT_DOWN,q),M(Z.INDICES,q),X(q)];await Promise.allSettled(U)},E=async S=>{S?await M(S):await Y()},c=S=>{h.value=S,Object.keys(l.value).forEach(q=>{l.value[q]=null})},m=S=>{if(!S.trim())return g.value;const q=S.toLowerCase();return g.value.filter(U=>U.code.toLowerCase().includes(q)||U.name.toLowerCase().includes(q))},F=S=>g.value.find(q=>q.code===S)||null,O=()=>{e.value=null},T=S=>{S?l.value[S]=null:Object.keys(l.value).forEach(q=>{l.value[q]=null})},$=async S=>{const q=S||h.value;try{return a.value=!0,n.value=0,s.value="开始生成数据...",await Y(q),n.value=100,s.value="数据生成完成",{sse:_.value,szse:K.value,limitUp:L.value,limitDown:b.value,indices:P.value,marketStats:B.value}}catch(U){throw console.error("生成完整数据失败:",U),s.value=`生成失败: ${U.message}`,U}finally{a.value=!1,setTimeout(()=>{n.value=0,s.value=""},3e3)}},N=async S=>{const q=S||h.value;try{a.value=!0,s.value="正在生成分析报告...";const U=g.value,A=L.value,j=b.value,ie=P.value,ce={date:q,summary:{totalStocks:U.length,limitUpStocks:A.length,limitDownStocks:j.length,indicesCount:ie.length},topGainers:U.filter(y=>y.changePercent>0).sort((y,p)=>p.changePercent-y.changePercent).slice(0,10),topLosers:U.filter(y=>y.changePercent<0).sort((y,p)=>y.changePercent-p.changePercent).slice(0,10),mostActive:U.sort((y,p)=>p.volume-y.volume).slice(0,10),indices:ie,generatedAt:new Date().toISOString()};return i.value=ce,s.value="分析报告生成完成",ce}catch(U){throw console.error("生成分析报告失败:",U),s.value=`分析失败: ${U.message}`,U}finally{a.value=!1,setTimeout(()=>{s.value=""},3e3)}},se=async(S,q)=>{const U=q||h.value;try{return a.value=!0,s.value=`正在刷新 ${S} 数据...`,await M(S,U),s.value=`${S} 数据刷新完成`,l.value[S]?.data}catch(A){throw console.error(`刷新 ${S} 数据失败:`,A),s.value=`刷新失败: ${A.message}`,A}finally{a.value=!1,setTimeout(()=>{s.value=""},3e3)}},ne=async()=>{try{const S=ue.getStatus();return u.value=S,S}catch(S){return console.error("获取缓存状态失败:",S),u.value={error:S.message},u.value}};return{currentDate:h,loading:t,error:e,generationLoading:a,generationProgress:n,generationMessage:s,analysisResult:i,cacheStatus:u,isLoading:V,hasData:ae,sseData:_,szseData:K,limitUpData:L,limitDownData:b,indicesData:P,marketStatsData:B,allStockData:g,statistics:R,fetchData:M,fetchMarketStats:X,fetchAllData:Y,refreshData:E,setCurrentDate:c,searchStocks:m,getStockByCode:F,clearError:O,clearCache:T,generateCompleteData:$,generateAnalysis:N,refreshDataType:se,getCacheStatusInfo:ne,cleanupExpiredCache:async S=>{try{await ue.clearCache(),await ne()}catch(q){throw console.error("清理缓存失败:",q),q}},getGenerationStatus:()=>({loading:a.value,progress:n.value,message:s.value,hasAnalysis:i.value!==null,cacheStatus:u.value})}});var pe=(h=>(h.SSE="sse",h.SZSE="szse",h.LIMIT_UP="limitup",h.LIMIT_DOWN="limitdown",h.INDICES="indices",h))(pe||{});const Ct={class:"stock-data-table"},Rt={class:"toolbar"},kt={class:"toolbar-left"},xt={class:"toolbar-right"},Tt={class:"statistics"},Nt={class:"table-container"},Ot={class:"pagination"},It={key:0,class:"stock-detail"},At=fe({__name:"StockDataTable",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1},title:{default:"股票数据"}},setup(h){const t=h,e=z(""),a=z("chg_rate"),n=z("desc"),s=z(1),i=z(50),u=z(!1),l=z(null),v=G(()=>{let c=[...t.data];if(e.value.trim()){const m=e.value.toLowerCase();c=c.filter(F=>F.code.toLowerCase().includes(m)||F.name.toLowerCase().includes(m))}return a.value&&c.sort((m,F)=>{let O=m[a.value],T=F[a.value];return O==null&&(O=0),T==null&&(T=0),typeof O=="string"&&typeof T=="string"?n.value==="asc"?O.localeCompare(T):T.localeCompare(O):n.value==="asc"?O-T:T-O}),c}),V=G(()=>{const c=(s.value-1)*i.value,m=c+i.value;return v.value.slice(c,m)}),ae=G(()=>v.value.length===0?0:v.value.reduce((m,F)=>m+(F.chg_rate||0),0)/v.value.length),_=G(()=>v.value.filter(c=>(c.chg_rate||0)>0).length),K=G(()=>v.value.filter(c=>(c.chg_rate||0)<0).length),L=c=>c?c>0?"price-up":c<0?"price-down":"price-flat":"",b=c=>c?c>0?"success":c<0?"danger":"info":"info",P=c=>c?c>=1e8?`${(c/1e8).toFixed(2)}亿`:c>=1e4?`${(c/1e4).toFixed(2)}万`:c.toString():"0",B=c=>c?c>=1e8?`${(c/1e8).toFixed(2)}亿`:c>=1e4?`${(c/1e4).toFixed(2)}万`:c.toFixed(2):"0",g=()=>{s.value=1},R=()=>{s.value=1},D=({prop:c,order:m})=>{c&&(a.value=c,n.value=m==="ascending"?"asc":"desc")},I=c=>{i.value=c,s.value=1},M=c=>{s.value=c},X=c=>{l.value=c,u.value=!0},Y=()=>{try{const c=["代码","名称","最新价","涨跌额","涨跌幅(%)","开盘价","最高价","最低价","昨收价","成交量","成交额","振幅(%)","交易阶段"],m=v.value.map(N=>[N.code,N.name,N.last?.toFixed(2)||"",N.change?.toFixed(2)||"",N.chg_rate?.toFixed(2)||"",N.open?.toFixed(2)||"",N.high?.toFixed(2)||"",N.low?.toFixed(2)||"",N.prev_close?.toFixed(2)||"",N.volume?.toString()||"",N.amount?.toFixed(2)||"",N.amp_rate?.toFixed(2)||"",N.tradephase||""]),F=[c.join(","),...m.map(N=>N.join(","))].join(`
`),O=new Blob(["\uFEFF"+F],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(O),$=document.createElement("a");$.href=T,$.download=`${t.title}_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(T),oe.success("CSV 文件导出成功")}catch(c){console.error("导出失败:",c),oe.error("导出失败")}},E=()=>{oe.info("刷新功能待实现")};return _e(()=>t.data,()=>{s.value=1},{immediate:!0}),(c,m)=>{const F=ge,O=ye,T=Ne,$=Te,N=ve,se=Ae,ne=Ie,ee=Oe,H=$e,S=Fe,q=De,U=Le,A=Me,j=Re,ie=Ce,ce=Ee,y=qe;return C(),Q("div",Ct,[w("div",Rt,[w("div",kt,[r(O,{modelValue:e.value,"onUpdate:modelValue":m[0]||(m[0]=p=>e.value=p),placeholder:"搜索股票代码或名称...",clearable:"",style:{width:"250px"},onInput:g},{prefix:o(()=>[r(F,null,{default:o(()=>[r(x(be))]),_:1})]),_:1},8,["modelValue"]),r($,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=p=>a.value=p),placeholder:"排序字段",style:{width:"120px","margin-left":"10px"},onChange:R},{default:o(()=>[r(T,{label:"涨跌幅",value:"chg_rate"}),r(T,{label:"成交额",value:"amount"}),r(T,{label:"成交量",value:"volume"}),r(T,{label:"股票代码",value:"code"}),r(T,{label:"股票名称",value:"name"})]),_:1},8,["modelValue"]),r($,{modelValue:n.value,"onUpdate:modelValue":m[2]||(m[2]=p=>n.value=p),placeholder:"排序方式",style:{width:"100px","margin-left":"10px"},onChange:R},{default:o(()=>[r(T,{label:"降序",value:"desc"}),r(T,{label:"升序",value:"asc"})]),_:1},8,["modelValue"])]),w("div",xt,[r(N,{size:"small",onClick:Y},{default:o(()=>[r(F,null,{default:o(()=>[r(x(we))]),_:1}),m[6]||(m[6]=f(" 导出 CSV ",-1))]),_:1}),r(N,{size:"small",onClick:E},{default:o(()=>[r(F,null,{default:o(()=>[r(x(Ze))]),_:1}),m[7]||(m[7]=f(" 刷新 ",-1))]),_:1})])]),w("div",Tt,[r(ee,{gutter:16},{default:o(()=>[r(ne,{span:6},{default:o(()=>[r(se,{title:"股票总数",value:v.value.length},null,8,["value"])]),_:1}),r(ne,{span:6},{default:o(()=>[r(se,{title:"平均涨跌幅",value:ae.value,precision:2,suffix:"%"},null,8,["value"])]),_:1}),r(ne,{span:6},{default:o(()=>[r(se,{title:"上涨家数",value:_.value},null,8,["value"])]),_:1}),r(ne,{span:6},{default:o(()=>[r(se,{title:"下跌家数",value:K.value},null,8,["value"])]),_:1})]),_:1})]),w("div",Nt,[Ue((C(),W(U,{data:V.value,height:"500",stripe:"",border:"",size:"small",onSortChange:D},{default:o(()=>[r(H,{type:"index",width:"50",label:"#"}),r(H,{prop:"code",label:"代码",width:"80",sortable:"custom"},{default:o(({row:p})=>[r(S,{type:"primary",onClick:ke=>X(p)},{default:o(()=>[f(d(p.code),1)]),_:2},1032,["onClick"])]),_:1}),r(H,{prop:"name",label:"名称",width:"120",sortable:"custom"}),r(H,{prop:"last",label:"最新价",width:"80",sortable:"custom",align:"right"},{default:o(({row:p})=>[w("span",{class:re(L(p.chg_rate))},d(p.last?.toFixed(2)),3)]),_:1}),r(H,{prop:"change",label:"涨跌额",width:"80",sortable:"custom",align:"right"},{default:o(({row:p})=>[w("span",{class:re(L(p.chg_rate))},d(p.change?.toFixed(2)),3)]),_:1}),r(H,{prop:"chg_rate",label:"涨跌幅",width:"80",sortable:"custom",align:"right"},{default:o(({row:p})=>[r(q,{type:b(p.chg_rate),size:"small"},{default:o(()=>[f(d(p.chg_rate?.toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),r(H,{prop:"open",label:"开盘价",width:"80",align:"right"},{default:o(({row:p})=>[f(d(p.open?.toFixed(2)),1)]),_:1}),r(H,{prop:"high",label:"最高价",width:"80",align:"right"},{default:o(({row:p})=>[f(d(p.high?.toFixed(2)),1)]),_:1}),r(H,{prop:"low",label:"最低价",width:"80",align:"right"},{default:o(({row:p})=>[f(d(p.low?.toFixed(2)),1)]),_:1}),r(H,{prop:"volume",label:"成交量",width:"100",sortable:"custom",align:"right"},{default:o(({row:p})=>[f(d(P(p.volume)),1)]),_:1}),r(H,{prop:"amount",label:"成交额",width:"100",sortable:"custom",align:"right"},{default:o(({row:p})=>[f(d(B(p.amount)),1)]),_:1}),r(H,{prop:"amp_rate",label:"振幅",width:"70",align:"right"},{default:o(({row:p})=>[f(d(p.amp_rate?.toFixed(2))+"% ",1)]),_:1}),r(H,{label:"操作",width:"80",fixed:"right"},{default:o(({row:p})=>[r(N,{size:"small",type:"text",onClick:ke=>X(p)},{default:o(()=>[...m[8]||(m[8]=[f(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[y,h.loading]]),w("div",Ot,[r(A,{"current-page":s.value,"onUpdate:currentPage":m[3]||(m[3]=p=>s.value=p),"page-size":i.value,"onUpdate:pageSize":m[4]||(m[4]=p=>i.value=p),"page-sizes":[20,50,100,200],total:v.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),r(ce,{modelValue:u.value,"onUpdate:modelValue":m[5]||(m[5]=p=>u.value=p),title:`股票详情 - ${l.value?.name} (${l.value?.code})`,width:"600px"},{default:o(()=>[l.value?(C(),Q("div",It,[r(ie,{column:2,border:""},{default:o(()=>[r(j,{label:"股票代码"},{default:o(()=>[f(d(l.value.code),1)]),_:1}),r(j,{label:"股票名称"},{default:o(()=>[f(d(l.value.name),1)]),_:1}),r(j,{label:"最新价"},{default:o(()=>[w("span",{class:re(L(l.value.chg_rate))},d(l.value.last?.toFixed(2)),3)]),_:1}),r(j,{label:"涨跌额"},{default:o(()=>[w("span",{class:re(L(l.value.chg_rate))},d(l.value.change?.toFixed(2)),3)]),_:1}),r(j,{label:"涨跌幅"},{default:o(()=>[r(q,{type:b(l.value.chg_rate)},{default:o(()=>[f(d(l.value.chg_rate?.toFixed(2))+"% ",1)]),_:1},8,["type"])]),_:1}),r(j,{label:"振幅"},{default:o(()=>[f(d(l.value.amp_rate?.toFixed(2))+"% ",1)]),_:1}),r(j,{label:"开盘价"},{default:o(()=>[f(d(l.value.open?.toFixed(2)),1)]),_:1}),r(j,{label:"最高价"},{default:o(()=>[f(d(l.value.high?.toFixed(2)),1)]),_:1}),r(j,{label:"最低价"},{default:o(()=>[f(d(l.value.low?.toFixed(2)),1)]),_:1}),r(j,{label:"昨收价"},{default:o(()=>[f(d(l.value.prev_close?.toFixed(2)),1)]),_:1}),r(j,{label:"成交量"},{default:o(()=>[f(d(P(l.value.volume)),1)]),_:1}),r(j,{label:"成交额"},{default:o(()=>[f(d(B(l.value.amount)),1)]),_:1}),r(j,{label:"交易阶段"},{default:o(()=>[f(d(l.value.tradephase),1)]),_:1}),r(j,{label:"产品类型"},{default:o(()=>[f(d(l.value.cpxxsubtype),1)]),_:1})]),_:1})])):Se("",!0)]),_:1},8,["modelValue","title"])])}}}),Ye=he(At,[["__scopeId","data-v-36d0dd25"]]),Ut={class:"json-node"},qt=["onClick"],$t={class:"node-toggle"},Ft={key:1,class:"no-toggle"},Lt={class:"node-index"},Mt={key:1,class:"node-type"},jt={key:0,class:"node-children"},zt=["onClick"],Pt={class:"node-toggle"},Bt={key:1,class:"no-toggle"},Vt={class:"node-key"},Ht={key:1,class:"node-type"},Kt={key:0,class:"node-children"},Yt={key:2,class:"node-item"},Wt=fe({__name:"JsonNode",props:{data:{},path:{},searchKeyword:{},expandedNodes:{}},emits:["toggleExpand"],setup(h,{emit:t}){const e=h,a=t,n=_=>e.expandedNodes.has(_.map(K=>String(K)).join(".")),s=_=>(Array.isArray(_)||typeof _=="object"&&_!==null)&&Object.keys(_).length>0,i=_=>e.searchKeyword.trim()?e.expandedNodes.has(_.map(K=>String(K)).join(".")):!1,u=_=>{s(_.reduce((K,L)=>K?.[L],e.data))&&a("toggleExpand",_)},l=_=>_===null?"value-null":typeof _=="string"?"value-string":typeof _=="number"?"value-number":typeof _=="boolean"?"value-boolean":"",v=_=>_===null?"null":typeof _=="string"?`"${_}"`:typeof _=="boolean"?_?"true":"false":typeof _=="number"?_.toString():typeof _>"u"?"undefined":String(_),V=_=>Array.isArray(_)?"Array":_===null?"null":typeof _=="object"?"Object":typeof _=="string"?"String":typeof _=="number"?"Number":typeof _=="boolean"?"Boolean":typeof _,ae=_=>Array.isArray(_)?_.length:typeof _=="object"&&_!==null?Object.keys(_).length:0;return(_,K)=>{const L=ge,b=rt("json-node",!0);return C(),Q("div",Ut,[Array.isArray(h.data)?(C(!0),Q(Be,{key:0},Ve(h.data,(P,B)=>(C(),Q("div",{key:`array-${B}`,class:"node-item"},[w("div",{class:"node-header",onClick:g=>u([...h.path,String(B)])},[w("span",$t,[s(P)?(C(),W(L,{key:0},{default:o(()=>[n([...h.path,String(B)])?(C(),W(x(Ke),{key:1})):(C(),W(x(He),{key:0}))]),_:2},1024)):(C(),Q("span",Ft))]),w("span",Lt,d(B)+":",1),s(P)?(C(),Q("span",Mt,d(V(P))+"["+d(ae(P))+"] ",1)):(C(),Q("span",{key:0,class:re(["node-value",l(P)])},d(v(P)),3))],8,qt),s(P)&&n([...h.path,String(B)])?(C(),Q("div",jt,[r(b,{data:P,path:[...h.path,String(B)],"search-keyword":h.searchKeyword,"expanded-nodes":h.expandedNodes,onToggleExpand:K[0]||(K[0]=g=>_.$emit("toggleExpand",g))},null,8,["data","path","search-keyword","expanded-nodes"])])):Se("",!0)]))),128)):typeof h.data=="object"&&h.data!==null?(C(!0),Q(Be,{key:1},Ve(h.data,(P,B)=>(C(),Q("div",{key:`object-${B}`,class:re(["node-item",{"search-highlight":i([...h.path,B])}])},[w("div",{class:"node-header",onClick:g=>u([...h.path,B])},[w("span",Pt,[s(P)?(C(),W(L,{key:0},{default:o(()=>[n([...h.path,B])?(C(),W(x(Ke),{key:1})):(C(),W(x(He),{key:0}))]),_:2},1024)):(C(),Q("span",Bt))]),w("span",Vt,'"'+d(B)+'":',1),s(P)?(C(),Q("span",Ht,d(V(P))+d(Array.isArray(P)||typeof P=="object"?` [${ae(P)}]`:""),1)):(C(),Q("span",{key:0,class:re(["node-value",l(P)])},d(v(P)),3))],8,zt),s(P)&&n([...h.path,B])?(C(),Q("div",Kt,[r(b,{data:P,path:[...h.path,B],"search-keyword":h.searchKeyword,"expanded-nodes":h.expandedNodes,onToggleExpand:K[1]||(K[1]=g=>_.$emit("toggleExpand",g))},null,8,["data","path","search-keyword","expanded-nodes"])])):Se("",!0)],2))),128)):(C(),Q("div",Yt,[w("span",{class:re(["node-value",l(h.data)])},d(v(h.data)),3)]))])}}}),Zt=he(Wt,[["__scopeId","data-v-6a6d429b"]]),Jt={class:"json-display"},Xt={class:"toolbar"},Gt={class:"toolbar-left"},Qt={class:"toolbar-right"},ea={key:0,class:"no-data"},ta={key:1,class:"json-tree"},aa={class:"json-stats"},sa=fe({__name:"JsonDisplay",props:{data:{default:null},title:{default:"JSON 数据"}},setup(h){const t=h,e=z(""),a=z(new Set),n=z(new Set),s=z(),i=G(()=>t.data?(e.value.trim(),t.data):null),u=G(()=>t.data?l(t.data):0),l=g=>g==null?1:Array.isArray(g)?g.reduce((R,D)=>R+l(D),0):typeof g=="object"?Object.keys(g).reduce((R,D)=>R+1+l(g[D]),0):1,v=g=>g===null?{label:"null",type:"info"}:Array.isArray(g)?{label:"Array",type:"success"}:typeof g=="object"?{label:"Object",type:"warning"}:typeof g=="string"?{label:"String",type:"primary"}:typeof g=="number"?{label:"Number",type:"success"}:typeof g=="boolean"?{label:"Boolean",type:"danger"}:{label:"Unknown",type:"info"},V=g=>{const R=g.map(D=>String(D)).join(".");a.value.has(R)?a.value.delete(R):a.value.add(R)},ae=()=>{K(t.data,[]).forEach(R=>{a.value.add(R.join("."))})},_=()=>{a.value.clear()},K=(g,R)=>{const D=[];return Array.isArray(g)?g.forEach((I,M)=>{const X=[...R,M];D.push(X),typeof I=="object"&&I!==null&&D.push(...K(I,X))}):typeof g=="object"&&g!==null&&Object.keys(g).forEach(I=>{const M=[...R,I];D.push(M);const X=g[I];typeof X=="object"&&X!==null&&D.push(...K(X,M))}),D},L=()=>{if(!e.value.trim()){n.value.clear();return}const g=b(t.data,[],e.value.toLowerCase());n.value=new Set(g.map(R=>R.join("."))),g.forEach(R=>{for(let D=1;D<=R.length;D++)a.value.add(R.slice(0,D).join("."))})},b=(g,R,D)=>{const I=[];return g==null||(typeof g=="string"&&g.toLowerCase().includes(D)||typeof g=="number"&&g.toString().includes(D)?I.push(R):Array.isArray(g)?g.forEach((M,X)=>{const Y=[...R,X];typeof M=="object"&&M!==null?I.push(...b(M,Y,D)):(typeof M=="string"&&M.toLowerCase().includes(D)||typeof M=="number"&&M.toString().includes(D))&&I.push(Y)}):typeof g=="object"&&Object.keys(g).forEach(M=>{const X=[...R,M];M.toLowerCase().includes(D)&&I.push(X);const Y=g[M];typeof Y=="object"&&Y!==null?I.push(...b(Y,X,D)):(typeof Y=="string"&&Y.toLowerCase().includes(D)||typeof Y=="number"&&Y.toString().includes(D))&&I.push(X)})),I},P=async()=>{try{const g=JSON.stringify(t.data,null,2);await navigator.clipboard.writeText(g),oe.success("JSON 已复制到剪贴板")}catch(g){console.error("复制失败:",g),oe.error("复制失败")}},B=()=>{try{const g=JSON.stringify(t.data,null,2),R=new Blob([g],{type:"application/json"}),D=URL.createObjectURL(R),I=document.createElement("a");I.href=D,I.download=`${t.title||"data"}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(D),oe.success("文件下载成功")}catch(g){console.error("下载失败:",g),oe.error("下载失败")}};return _e(()=>t.data,g=>{g&&typeof g=="object"&&ct(()=>{a.value.clear(),Array.isArray(g)?g.forEach((R,D)=>{a.value.add(String(D))}):Object.keys(g).forEach(R=>{a.value.add(R)})})},{immediate:!0}),(g,R)=>{const D=ge,I=ye,M=ve,X=nt,Y=Je,E=De,c=Re,m=Ce;return C(),Q("div",Jt,[w("div",Xt,[w("div",Gt,[r(I,{modelValue:e.value,"onUpdate:modelValue":R[0]||(R[0]=F=>e.value=F),placeholder:"搜索 JSON 内容...",clearable:"",style:{width:"300px"},onInput:L},{prefix:o(()=>[r(D,null,{default:o(()=>[r(x(be))]),_:1})]),_:1},8,["modelValue"]),r(X,{style:{"margin-left":"10px"}},{default:o(()=>[r(M,{size:"small",onClick:ae},{default:o(()=>[r(D,null,{default:o(()=>[r(x(ot))]),_:1}),R[1]||(R[1]=f(" 展开全部 ",-1))]),_:1}),r(M,{size:"small",onClick:_},{default:o(()=>[r(D,null,{default:o(()=>[r(x(lt))]),_:1}),R[2]||(R[2]=f(" 折叠全部 ",-1))]),_:1})]),_:1})]),w("div",Qt,[r(M,{size:"small",onClick:P},{default:o(()=>[r(D,null,{default:o(()=>[r(x(it))]),_:1}),R[3]||(R[3]=f(" 复制 JSON ",-1))]),_:1}),r(M,{size:"small",onClick:B},{default:o(()=>[r(D,null,{default:o(()=>[r(x(we))]),_:1}),R[4]||(R[4]=f(" 下载文件 ",-1))]),_:1})])]),w("div",{class:"json-content",ref_key:"jsonContentRef",ref:s},[i.value===null?(C(),Q("div",ea,[r(Y,{description:"无数据"})])):(C(),Q("div",ta,[r(Zt,{data:i.value,path:[],"search-keyword":e.value,"expanded-nodes":a.value,onToggleExpand:V},null,8,["data","search-keyword","expanded-nodes"])]))],512),w("div",aa,[r(m,{column:4,size:"small",border:""},{default:o(()=>[r(c,{label:"数据类型"},{default:o(()=>[r(E,{type:v(h.data).type,size:"small"},{default:o(()=>[f(d(v(h.data).label),1)]),_:1},8,["type"])]),_:1}),r(c,{label:"节点总数"},{default:o(()=>[f(d(u.value),1)]),_:1}),r(c,{label:"展开节点"},{default:o(()=>[f(d(a.value.size),1)]),_:1}),r(c,{label:"搜索结果"},{default:o(()=>[f(d(n.value.size),1)]),_:1})]),_:1})])])}}}),me=he(sa,[["__scopeId","data-v-31046181"]]),ra={class:"limit-stock-table"},na={class:"toolbar"},oa={class:"toolbar-left"},la={class:"toolbar-right"},ia={class:"statistics"},ca={class:"table-container"},ua={class:"limit-price"},da={class:"pagination"},ha={key:0,class:"stock-detail"},fa={class:"limit-price"},pa=fe({__name:"LimitStockTable",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1},title:{default:"涨停股票"}},setup(h){const t=h,e=z(""),a=z("rank"),n=z("asc"),s=z(1),i=z(20),u=z(!1),l=z(null),v=G(()=>{let c=[...t.data];if(e.value.trim()){const m=e.value.toLowerCase();c=c.filter(F=>F.code.toLowerCase().includes(m)||F.name.toLowerCase().includes(m))}return a.value&&c.sort((m,F)=>{let O=m[a.value],T=F[a.value];return O==null&&(O=0),T==null&&(T=0),typeof O=="string"&&typeof T=="string"?n.value==="asc"?O.localeCompare(T):T.localeCompare(O):n.value==="asc"?O-T:T-O}),c}),V=G(()=>{const c=(s.value-1)*i.value,m=c+i.value;return v.value.slice(c,m)}),ae=G(()=>t.data.filter(c=>c.boardType==="主板").length),_=G(()=>t.data.filter(c=>c.boardType==="创业板").length),K=G(()=>v.value.length===0?0:v.value.reduce((m,F)=>m+(F.actualChangeRate||0),0)/v.value.length),L=c=>c===1?"danger":c<=3?"warning":c<=10?"success":"info",b=c=>c?c>0?"price-up":c<0?"price-down":"price-flat":"price-flat",P=c=>c?c>0?"danger":c<0?"success":"info":"info",B=c=>c?c>=1e8?`${(c/1e8).toFixed(2)}亿`:c>=1e4?`${(c/1e4).toFixed(2)}万`:c.toString():"0",g=c=>c?c>=1e8?`${(c/1e8).toFixed(2)}亿`:c>=1e4?`${(c/1e4).toFixed(2)}万`:c.toFixed(2):"0",R=()=>{s.value=1},D=()=>{s.value=1},I=({prop:c,order:m})=>{c&&(a.value=c,n.value=m==="ascending"?"asc":"desc")},M=c=>{i.value=c,s.value=1},X=c=>{s.value=c},Y=c=>{l.value=c,u.value=!0},E=()=>{try{const c=["排名","代码","名称","交易所","板块","昨收价","最新价","涨停价","涨跌额","涨跌幅(%)","振幅(%)","成交量","成交额","开盘价","最高价","最低价"],m=v.value.map(N=>[N.rank?.toString()||"",N.code,N.name,N.exchange,N.boardType,N.prevClose?.toFixed(2)||"",N.last?.toFixed(2)||"",N.limitThreshold?.toFixed(2)||"",N.change?.toFixed(2)||"",N.actualChangeRate?.toFixed(2)||"",N.amp_rate?.toFixed(2)||"",N.volume?.toString()||"",N.amount?.toFixed(2)||"",N.open?.toFixed(2)||"",N.high?.toFixed(2)||"",N.low?.toFixed(2)||""]),F=[c.join(","),...m.map(N=>N.join(","))].join(`
`),O=new Blob(["\uFEFF"+F],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(O),$=document.createElement("a");$.href=T,$.download=`${t.title}_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(T),oe.success("CSV 文件导出成功")}catch(c){console.error("导出失败:",c),oe.error("导出失败")}};return _e(()=>t.data,()=>{s.value=1},{immediate:!0}),(c,m)=>{const F=ge,O=ye,T=Ne,$=Te,N=ve,se=Ae,ne=Ie,ee=Oe,H=$e,S=De,q=Fe,U=Le,A=Me,j=Re,ie=Ce,ce=Ee,y=qe;return C(),Q("div",ra,[w("div",na,[w("div",oa,[r(O,{modelValue:e.value,"onUpdate:modelValue":m[0]||(m[0]=p=>e.value=p),placeholder:"搜索股票代码或名称...",clearable:"",style:{width:"250px"},onInput:R},{prefix:o(()=>[r(F,null,{default:o(()=>[r(x(be))]),_:1})]),_:1},8,["modelValue"]),r($,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=p=>a.value=p),placeholder:"排序字段",style:{width:"120px","margin-left":"10px"},onChange:D},{default:o(()=>[r(T,{label:"排名",value:"rank"}),r(T,{label:"涨跌幅",value:"actualChangeRate"}),r(T,{label:"成交额",value:"amount"}),r(T,{label:"振幅",value:"amp_rate"}),r(T,{label:"股票代码",value:"code"})]),_:1},8,["modelValue"]),r($,{modelValue:n.value,"onUpdate:modelValue":m[2]||(m[2]=p=>n.value=p),placeholder:"排序方式",style:{width:"100px","margin-left":"10px"},onChange:D},{default:o(()=>[r(T,{label:"升序",value:"asc"}),r(T,{label:"降序",value:"desc"})]),_:1},8,["modelValue"])]),w("div",la,[r(N,{size:"small",onClick:E},{default:o(()=>[r(F,null,{default:o(()=>[r(x(we))]),_:1}),m[6]||(m[6]=f(" 导出 CSV ",-1))]),_:1})])]),w("div",ia,[r(ee,{gutter:16},{default:o(()=>[r(ne,{span:6},{default:o(()=>[r(se,{title:"股票总数",value:v.value.length},null,8,["value"])]),_:1}),r(ne,{span:6},{default:o(()=>[r(se,{title:"主板股票",value:ae.value},null,8,["value"])]),_:1}),r(ne,{span:6},{default:o(()=>[r(se,{title:"创业板股票",value:_.value},null,8,["value"])]),_:1}),r(ne,{span:6},{default:o(()=>[r(se,{title:"平均涨跌幅",value:K.value,precision:2,suffix:"%"},null,8,["value"])]),_:1})]),_:1})]),w("div",ca,[Ue((C(),W(U,{data:V.value,height:"400",stripe:"",border:"",size:"small",onSortChange:I},{default:o(()=>[r(H,{type:"index",width:"50",label:"#"}),r(H,{prop:"rank",label:"排名",width:"60",sortable:"custom",align:"center"},{default:o(({row:p})=>[r(S,{type:L(p.rank),size:"small",effect:"dark"},{default:o(()=>[f(d(p.rank),1)]),_:2},1032,["type"])]),_:1}),r(H,{prop:"code",label:"代码",width:"80",sortable:"custom"},{default:o(({row:p})=>[r(q,{type:"primary",onClick:ke=>Y(p)},{default:o(()=>[f(d(p.code),1)]),_:2},1032,["onClick"])]),_:1}),r(H,{prop:"name",label:"名称",width:"120",sortable:"custom"}),r(H,{prop:"exchange",label:"交易所",width:"80",align:"center"},{default:o(({row:p})=>[r(S,{type:p.exchange==="SSE"?"primary":"success",size:"small"},{default:o(()=>[f(d(p.exchange),1)]),_:2},1032,["type"])]),_:1}),r(H,{prop:"boardType",label:"板块",width:"80",align:"center"},{default:o(({row:p})=>[r(S,{size:"small"},{default:o(()=>[f(d(p.boardType),1)]),_:2},1024)]),_:1}),r(H,{prop:"prevClose",label:"昨收价",width:"80",align:"right"},{default:o(({row:p})=>[f(d(p.prevClose?.toFixed(2)),1)]),_:1}),r(H,{prop:"last",label:"最新价",width:"80",sortable:"custom",align:"right"},{default:o(({row:p})=>[w("span",{class:re(b(p.actualChangeRate))},d(p.last?.toFixed(2)),3)]),_:1}),r(H,{prop:"limitThreshold",label:"涨停价",width:"80",align:"right"},{default:o(({row:p})=>[w("span",ua,d(p.limitThreshold?.toFixed(2)),1)]),_:1}),r(H,{prop:"change",label:"涨跌额",width:"80",sortable:"custom",align:"right"},{default:o(({row:p})=>[w("span",{class:re(b(p.change))},d(p.change?.toFixed(2)),3)]),_:1}),r(H,{prop:"actualChangeRate",label:"涨跌幅",width:"80",sortable:"custom",align:"right"},{default:o(({row:p})=>[r(S,{type:P(p.actualChangeRate),size:"small"},{default:o(()=>[f(d(p.actualChangeRate?.toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),r(H,{prop:"amp_rate",label:"振幅",width:"70",sortable:"custom",align:"right"},{default:o(({row:p})=>[f(d(p.amp_rate?.toFixed(2))+"% ",1)]),_:1}),r(H,{prop:"volume",label:"成交量",width:"100",sortable:"custom",align:"right"},{default:o(({row:p})=>[f(d(B(p.volume)),1)]),_:1}),r(H,{prop:"amount",label:"成交额",width:"100",sortable:"custom",align:"right"},{default:o(({row:p})=>[f(d(g(p.amount)),1)]),_:1}),r(H,{label:"操作",width:"80",fixed:"right"},{default:o(({row:p})=>[r(N,{size:"small",type:"text",onClick:ke=>Y(p)},{default:o(()=>[...m[7]||(m[7]=[f(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[y,h.loading]]),w("div",da,[r(A,{"current-page":s.value,"onUpdate:currentPage":m[3]||(m[3]=p=>s.value=p),"page-size":i.value,"onUpdate:pageSize":m[4]||(m[4]=p=>i.value=p),"page-sizes":[20,50,100],total:v.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),r(ce,{modelValue:u.value,"onUpdate:modelValue":m[5]||(m[5]=p=>u.value=p),title:`涨停股票详情 - ${l.value?.name} (${l.value?.code})`,width:"600px"},{default:o(()=>[l.value?(C(),Q("div",ha,[r(ie,{column:2,border:""},{default:o(()=>[r(j,{label:"排名"},{default:o(()=>[r(S,{type:L(l.value.rank||0),effect:"dark"},{default:o(()=>[f(d(l.value.rank),1)]),_:1},8,["type"])]),_:1}),r(j,{label:"交易所"},{default:o(()=>[r(S,{type:l.value.exchange==="SSE"?"primary":"success"},{default:o(()=>[f(d(l.value.exchange),1)]),_:1},8,["type"])]),_:1}),r(j,{label:"股票代码"},{default:o(()=>[f(d(l.value.code),1)]),_:1}),r(j,{label:"股票名称"},{default:o(()=>[f(d(l.value.name),1)]),_:1}),r(j,{label:"板块类型"},{default:o(()=>[f(d(l.value.boardType),1)]),_:1}),r(j,{label:"昨收价"},{default:o(()=>[f(d(l.value.prevClose?.toFixed(2)),1)]),_:1}),r(j,{label:"最新价"},{default:o(()=>[w("span",{class:re(b(l.value.actualChangeRate))},d(l.value.last?.toFixed(2)),3)]),_:1}),r(j,{label:"涨停价"},{default:o(()=>[w("span",fa,d(l.value.limitThreshold?.toFixed(2)),1)]),_:1}),r(j,{label:"涨跌额"},{default:o(()=>[w("span",{class:re(b(l.value.change))},d(l.value.change?.toFixed(2)),3)]),_:1}),r(j,{label:"涨跌幅"},{default:o(()=>[r(S,{type:P(l.value.actualChangeRate)},{default:o(()=>[f(d(l.value.actualChangeRate?.toFixed(2))+"% ",1)]),_:1},8,["type"])]),_:1}),r(j,{label:"涨停阈值"},{default:o(()=>[f(d(((l.value.limitRate||0)*100).toFixed(1))+"% ",1)]),_:1}),r(j,{label:"振幅"},{default:o(()=>[f(d(l.value.amp_rate?.toFixed(2))+"% ",1)]),_:1}),r(j,{label:"开盘价"},{default:o(()=>[f(d(l.value.open?.toFixed(2)),1)]),_:1}),r(j,{label:"最高价"},{default:o(()=>[f(d(l.value.high?.toFixed(2)),1)]),_:1}),r(j,{label:"最低价"},{default:o(()=>[f(d(l.value.low?.toFixed(2)),1)]),_:1}),r(j,{label:"成交量"},{default:o(()=>[f(d(B(l.value.volume)),1)]),_:1}),r(j,{label:"成交额"},{default:o(()=>[f(d(g(l.value.amount)),1)]),_:1}),r(j,{label:"交易阶段"},{default:o(()=>[f(d(l.value.tradephase),1)]),_:1})]),_:1})])):Se("",!0)]),_:1},8,["modelValue","title"])])}}}),We=he(pa,[["__scopeId","data-v-101f783e"]]),ga={class:"index-data-table"},ma={class:"toolbar"},Sa={class:"toolbar-left"},_a={class:"toolbar-right"},va={class:"statistics"},ya={class:"table-container"},ba={class:"pagination"},wa={key:0,class:"index-detail"},Da=fe({__name:"IndexDataTable",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1},title:{default:"指数数据"}},setup(h){const t=h,e=z(""),a=z("chg_rate"),n=z("desc"),s=z(1),i=z(50),u=z(!1),l=z(null),v=G(()=>{let E=[...t.data];if(e.value.trim()){const c=e.value.toLowerCase();E=E.filter(m=>m.code.toLowerCase().includes(c)||m.name.toLowerCase().includes(c))}return a.value&&E.sort((c,m)=>{let F=c[a.value],O=m[a.value];return F==null&&(F=0),O==null&&(O=0),typeof F=="string"&&typeof O=="string"?n.value==="asc"?F.localeCompare(O):O.localeCompare(F):n.value==="asc"?F-O:O-F}),E}),V=G(()=>{const E=(s.value-1)*i.value,c=E+i.value;return v.value.slice(E,c)}),ae=G(()=>v.value.length===0?0:v.value.reduce((c,m)=>c+(m.chg_rate||0),0)/v.value.length),_=G(()=>v.value.filter(E=>(E.chg_rate||0)>0).length),K=G(()=>v.value.filter(E=>(E.chg_rate||0)<0).length),L=E=>E?E>0?"price-up":E<0?"price-down":"price-flat":"",b=E=>E?E>0?"success":E<0?"danger":"info":"info",P=E=>E?E>=1e8?`${(E/1e8).toFixed(2)}亿`:E>=1e4?`${(E/1e4).toFixed(2)}万`:E.toString():"0",B=E=>E?E>=1e8?`${(E/1e8).toFixed(2)}亿`:E>=1e4?`${(E/1e4).toFixed(2)}万`:E.toFixed(2):"0",g=()=>{s.value=1},R=()=>{s.value=1},D=({prop:E,order:c})=>{E&&(a.value=E,n.value=c==="ascending"?"asc":"desc")},I=E=>{i.value=E,s.value=1},M=E=>{s.value=E},X=E=>{l.value=E,u.value=!0},Y=()=>{try{const E=["代码","名称","市场","最新价","涨跌额","涨跌幅(%)","开盘价","最高价","最低价","昨收价","振幅(%)","成交量","成交额","总市值","市盈率","市净率","更新时间"],c=v.value.map($=>[$.code,$.name,$.market,$.last?.toFixed(2)||"",$.change?.toFixed(2)||"",$.chg_rate?.toFixed(2)||"",$.open?.toFixed(2)||"",$.high?.toFixed(2)||"",$.low?.toFixed(2)||"",$.prev_close?.toFixed(2)||"",$.amp_rate?.toFixed(2)||"",$.volume?.toString()||"",$.amount?.toFixed(2)||"",$.market_cap?.toFixed(2)||"",$.pe?.toFixed(2)||"",$.pb?.toFixed(2)||"",$.update_time||""]),m=[E.join(","),...c.map($=>$.join(","))].join(`
`),F=new Blob(["\uFEFF"+m],{type:"text/csv;charset=utf-8;"}),O=URL.createObjectURL(F),T=document.createElement("a");T.href=O,T.download=`${t.title}_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(O),oe.success("CSV 文件导出成功")}catch(E){console.error("导出失败:",E),oe.error("导出失败")}};return _e(()=>t.data,()=>{s.value=1},{immediate:!0}),(E,c)=>{const m=ge,F=ye,O=Ne,T=Te,$=ve,N=Ae,se=Ie,ne=Oe,ee=$e,H=Fe,S=De,q=Le,U=Me,A=Re,j=Ce,ie=Ee,ce=qe;return C(),Q("div",ga,[w("div",ma,[w("div",Sa,[r(F,{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=y=>e.value=y),placeholder:"搜索指数代码或名称...",clearable:"",style:{width:"250px"},onInput:g},{prefix:o(()=>[r(m,null,{default:o(()=>[r(x(be))]),_:1})]),_:1},8,["modelValue"]),r(T,{modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=y=>a.value=y),placeholder:"排序字段",style:{width:"120px","margin-left":"10px"},onChange:R},{default:o(()=>[r(O,{label:"涨跌幅",value:"chg_rate"}),r(O,{label:"成交额",value:"amount"}),r(O,{label:"成交量",value:"volume"}),r(O,{label:"市值",value:"market_cap"}),r(O,{label:"指数代码",value:"code"})]),_:1},8,["modelValue"]),r(T,{modelValue:n.value,"onUpdate:modelValue":c[2]||(c[2]=y=>n.value=y),placeholder:"排序方式",style:{width:"100px","margin-left":"10px"},onChange:R},{default:o(()=>[r(O,{label:"降序",value:"desc"}),r(O,{label:"升序",value:"asc"})]),_:1},8,["modelValue"])]),w("div",_a,[r($,{size:"small",onClick:Y},{default:o(()=>[r(m,null,{default:o(()=>[r(x(we))]),_:1}),c[6]||(c[6]=f(" 导出 CSV ",-1))]),_:1})])]),w("div",va,[r(ne,{gutter:16},{default:o(()=>[r(se,{span:6},{default:o(()=>[r(N,{title:"指数总数",value:v.value.length},null,8,["value"])]),_:1}),r(se,{span:6},{default:o(()=>[r(N,{title:"上涨指数",value:_.value},null,8,["value"])]),_:1}),r(se,{span:6},{default:o(()=>[r(N,{title:"下跌指数",value:K.value},null,8,["value"])]),_:1}),r(se,{span:6},{default:o(()=>[r(N,{title:"平均涨跌幅",value:ae.value,precision:2,suffix:"%"},null,8,["value"])]),_:1})]),_:1})]),w("div",ya,[Ue((C(),W(q,{data:V.value,height:"400",stripe:"",border:"",size:"small",onSortChange:D},{default:o(()=>[r(ee,{type:"index",width:"50",label:"#"}),r(ee,{prop:"code",label:"代码",width:"80",sortable:"custom"},{default:o(({row:y})=>[r(H,{type:"primary",onClick:p=>X(y)},{default:o(()=>[f(d(y.code),1)]),_:2},1032,["onClick"])]),_:1}),r(ee,{prop:"name",label:"名称",width:"120",sortable:"custom"}),r(ee,{prop:"market",label:"市场",width:"80",align:"center"},{default:o(({row:y})=>[r(S,{type:y.market==="上海"?"primary":"success",size:"small"},{default:o(()=>[f(d(y.market),1)]),_:2},1032,["type"])]),_:1}),r(ee,{prop:"last",label:"最新价",width:"80",sortable:"custom",align:"right"},{default:o(({row:y})=>[w("span",{class:re(L(y.chg_rate))},d(y.last?.toFixed(2)),3)]),_:1}),r(ee,{prop:"change",label:"涨跌额",width:"80",sortable:"custom",align:"right"},{default:o(({row:y})=>[w("span",{class:re(L(y.chg_rate))},d(y.change?.toFixed(2)),3)]),_:1}),r(ee,{prop:"chg_rate",label:"涨跌幅",width:"80",sortable:"custom",align:"right"},{default:o(({row:y})=>[r(S,{type:b(y.chg_rate),size:"small"},{default:o(()=>[f(d(y.chg_rate?.toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),r(ee,{prop:"open",label:"开盘价",width:"80",align:"right"},{default:o(({row:y})=>[f(d(y.open?.toFixed(2)),1)]),_:1}),r(ee,{prop:"high",label:"最高价",width:"80",align:"right"},{default:o(({row:y})=>[f(d(y.high?.toFixed(2)),1)]),_:1}),r(ee,{prop:"low",label:"最低价",width:"80",align:"right"},{default:o(({row:y})=>[f(d(y.low?.toFixed(2)),1)]),_:1}),r(ee,{prop:"prev_close",label:"昨收价",width:"80",align:"right"},{default:o(({row:y})=>[f(d(y.prev_close?.toFixed(2)),1)]),_:1}),r(ee,{prop:"amp_rate",label:"振幅",width:"70",align:"right"},{default:o(({row:y})=>[f(d(y.amp_rate?.toFixed(2))+"% ",1)]),_:1}),r(ee,{prop:"volume",label:"成交量",width:"100",sortable:"custom",align:"right"},{default:o(({row:y})=>[f(d(P(y.volume)),1)]),_:1}),r(ee,{prop:"amount",label:"成交额",width:"100",sortable:"custom",align:"right"},{default:o(({row:y})=>[f(d(B(y.amount)),1)]),_:1}),r(ee,{prop:"market_cap",label:"总市值",width:"100",sortable:"custom",align:"right"},{default:o(({row:y})=>[f(d(B(Number(y.market_cap))),1)]),_:1}),r(ee,{prop:"pe",label:"市盈率",width:"70",align:"right"},{default:o(({row:y})=>[f(d(y.pe?.toFixed(2)||"--"),1)]),_:1}),r(ee,{prop:"pb",label:"市净率",width:"70",align:"right"},{default:o(({row:y})=>[f(d(y.pb?.toFixed(2)||"--"),1)]),_:1}),r(ee,{label:"操作",width:"80",fixed:"right"},{default:o(({row:y})=>[r($,{size:"small",type:"text",onClick:p=>X(y)},{default:o(()=>[...c[7]||(c[7]=[f(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,h.loading]]),w("div",ba,[r(U,{"current-page":s.value,"onUpdate:currentPage":c[3]||(c[3]=y=>s.value=y),"page-size":i.value,"onUpdate:pageSize":c[4]||(c[4]=y=>i.value=y),"page-sizes":[20,50,100],total:v.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),r(ie,{modelValue:u.value,"onUpdate:modelValue":c[5]||(c[5]=y=>u.value=y),title:`指数详情 - ${l.value?.name} (${l.value?.code})`,width:"700px"},{default:o(()=>[l.value?(C(),Q("div",wa,[r(j,{column:3,border:""},{default:o(()=>[r(A,{label:"指数代码"},{default:o(()=>[f(d(l.value.code),1)]),_:1}),r(A,{label:"指数名称"},{default:o(()=>[f(d(l.value.name),1)]),_:1}),r(A,{label:"所属市场"},{default:o(()=>[r(S,{type:l.value.market==="上海"?"primary":"success"},{default:o(()=>[f(d(l.value.market),1)]),_:1},8,["type"])]),_:1}),r(A,{label:"最新价"},{default:o(()=>[w("span",{class:re(L(l.value.chg_rate))},d(l.value.last?.toFixed(2)),3)]),_:1}),r(A,{label:"涨跌额"},{default:o(()=>[w("span",{class:re(L(l.value.chg_rate))},d(l.value.change?.toFixed(2)),3)]),_:1}),r(A,{label:"涨跌幅"},{default:o(()=>[r(S,{type:b(l.value.chg_rate)},{default:o(()=>[f(d(l.value.chg_rate?.toFixed(2))+"% ",1)]),_:1},8,["type"])]),_:1}),r(A,{label:"开盘价"},{default:o(()=>[f(d(l.value.open?.toFixed(2)),1)]),_:1}),r(A,{label:"最高价"},{default:o(()=>[f(d(l.value.high?.toFixed(2)),1)]),_:1}),r(A,{label:"最低价"},{default:o(()=>[f(d(l.value.low?.toFixed(2)),1)]),_:1}),r(A,{label:"昨收价"},{default:o(()=>[f(d(l.value.prev_close?.toFixed(2)),1)]),_:1}),r(A,{label:"振幅"},{default:o(()=>[f(d(l.value.amp_rate?.toFixed(2))+"% ",1)]),_:1}),r(A,{label:"成交量"},{default:o(()=>[f(d(P(l.value.volume)),1)]),_:1}),r(A,{label:"成交额"},{default:o(()=>[f(d(B(l.value.amount)),1)]),_:1}),r(A,{label:"总市值"},{default:o(()=>[f(d(B(Number(l.value.market_cap))),1)]),_:1}),r(A,{label:"市盈率"},{default:o(()=>[f(d(l.value.pe?.toFixed(2)||"--"),1)]),_:1}),r(A,{label:"市净率"},{default:o(()=>[f(d(l.value.pb?.toFixed(2)||"--"),1)]),_:1}),r(A,{label:"更新时间",span:3},{default:o(()=>[f(d(l.value.update_time),1)]),_:1})]),_:1})])):Se("",!0)]),_:1},8,["modelValue","title"])])}}}),Ea=he(Da,[["__scopeId","data-v-50bad07b"]]),Ca={class:"data-viewer"},Ra={class:"viewer-header"},ka={class:"header-left"},xa={class:"header-right"},Ta={class:"viewer-content"},Na={class:"tab-label"},Oa={class:"tab-content"},Ia={class:"tab-label"},Aa={class:"tab-content"},Ua={class:"tab-label"},qa={class:"tab-content"},$a={class:"tab-label"},Fa={class:"tab-content"},La={class:"tab-label"},Ma={class:"tab-content"},ja={class:"json-dialog-content"},za=fe({__name:"DataViewer",setup(h){const t=Et(),e=z("sse"),a=xe().hour()<16?xe().subtract(1,"day"):xe(),n=z(a.toDate()),s=z(!1),i=z(!1),u=L=>L.getTime()>Date.now(),l=L=>{const b=L.toISOString().split("T")[0];t.setCurrentDate(b),V(e.value)},v=L=>{const b=String(L);e.value=b,V(b)},V=async L=>{const b=n.value.toISOString().split("T")[0];switch(L){case"sse":await t.fetchData(pe.SSE,b);break;case"szse":await t.fetchData(pe.SZSE,b);break;case"limitup":await t.fetchData(pe.LIMIT_UP,b);break;case"limitdown":await t.fetchData(pe.LIMIT_DOWN,b);break;case"indices":await t.fetchData(pe.INDICES,b);break}},ae=async()=>{const L=n.value.toISOString().split("T")[0];try{await t.fetchAllData(L),oe.success("数据刷新成功")}catch{oe.error("数据刷新失败")}},_=()=>{s.value=!0},K=()=>{i.value=!i.value};return ut(async()=>{const L=n.value.toISOString().split("T")[0];t.setCurrentDate(L),await V(e.value)}),_e(()=>t.error,L=>{L&&(oe.error(L),t.clearError())}),(L,b)=>{const P=dt,B=ge,g=ve,R=gt,D=Je,I=pt,M=ht,X=Ee;return C(),Q("div",Ca,[w("div",Ra,[w("div",ka,[b[4]||(b[4]=w("h2",null,"股票数据展示",-1)),r(P,{modelValue:n.value,"onUpdate:modelValue":b[0]||(b[0]=Y=>n.value=Y),type:"date",placeholder:"选择日期","disabled-date":u,onChange:l,style:{"margin-left":"16px"}},null,8,["modelValue"])]),w("div",xa,[r(g,{onClick:ae,loading:x(t).isLoading},{default:o(()=>[r(B,null,{default:o(()=>[r(x(Ze))]),_:1}),b[5]||(b[5]=f(" 刷新数据 ",-1))]),_:1},8,["loading"]),r(g,{onClick:_},{default:o(()=>[r(B,null,{default:o(()=>[r(x(ft))]),_:1}),b[6]||(b[6]=f(" JSON 原始数据 ",-1))]),_:1})])]),w("div",Ta,[r(M,{modelValue:e.value,"onUpdate:modelValue":b[1]||(b[1]=Y=>e.value=Y),type:"card",onTabChange:v},{default:o(()=>[r(I,{label:"上证股票",name:"sse"},{label:o(()=>[w("span",Na,[b[7]||(b[7]=f(" 上证股票 ",-1)),r(R,{value:x(t).sseData?.length||0,type:"primary"},null,8,["value"])])]),default:o(()=>[w("div",Oa,[x(t).sseData?(C(),W(Ye,{key:0,data:x(t).sseData,loading:x(t).loading.sse,title:"上证股票"},null,8,["data","loading"])):(C(),W(D,{key:1,description:"暂无数据"}))])]),_:1}),r(I,{label:"深证股票",name:"szse"},{label:o(()=>[w("span",Ia,[b[8]||(b[8]=f(" 深证股票 ",-1)),r(R,{value:x(t).szseData?.length||0,type:"success"},null,8,["value"])])]),default:o(()=>[w("div",Aa,[x(t).szseData?(C(),W(Ye,{key:0,data:x(t).szseData,loading:x(t).loading.szse,title:"深证股票"},null,8,["data","loading"])):(C(),W(D,{key:1,description:"暂无数据"}))])]),_:1}),r(I,{label:"涨停股票",name:"limitup"},{label:o(()=>[w("span",Ua,[b[9]||(b[9]=f(" 涨停股票 ",-1)),r(R,{value:x(t).limitUpData?.length||0,type:"danger"},null,8,["value"])])]),default:o(()=>[w("div",qa,[x(t).limitUpData?(C(),W(We,{key:0,data:x(t).limitUpData,loading:x(t).loading.limitup,title:"涨停股票"},null,8,["data","loading"])):(C(),W(D,{key:1,description:"暂无数据"}))])]),_:1}),r(I,{label:"跌停股票",name:"limitdown"},{label:o(()=>[w("span",$a,[b[10]||(b[10]=f(" 跌停股票 ",-1)),r(R,{value:x(t).limitDownData?.length||0,type:"warning"},null,8,["value"])])]),default:o(()=>[w("div",Fa,[x(t).limitDownData?(C(),W(We,{key:0,data:x(t).limitDownData,loading:x(t).loading.limitdown,title:"跌停股票"},null,8,["data","loading"])):(C(),W(D,{key:1,description:"暂无数据"}))])]),_:1}),r(I,{label:"指数数据",name:"indices"},{label:o(()=>[w("span",La,[b[11]||(b[11]=f(" 指数数据 ",-1)),r(R,{value:x(t).indicesData?.length||0,type:"info"},null,8,["value"])])]),default:o(()=>[w("div",Ma,[x(t).indicesData?(C(),W(Ea,{key:0,data:x(t).indicesData,loading:x(t).loading.indices,title:"指数数据"},null,8,["data","loading"])):(C(),W(D,{key:1,description:"暂无数据"}))])]),_:1})]),_:1},8,["modelValue"])]),r(X,{modelValue:s.value,"onUpdate:modelValue":b[3]||(b[3]=Y=>s.value=Y),title:"JSON 原始数据",width:"90%",fullscreen:i.value,class:"json-dialog"},{footer:o(()=>[r(g,{onClick:K},{default:o(()=>[r(B,null,{default:o(()=>[i.value?(C(),W(x(St),{key:1})):(C(),W(x(mt),{key:0}))]),_:1}),f(" "+d(i.value?"退出全屏":"全屏显示"),1)]),_:1}),r(g,{type:"primary",onClick:b[2]||(b[2]=Y=>s.value=!1)},{default:o(()=>[...b[12]||(b[12]=[f(" 关闭 ",-1)])]),_:1})]),default:o(()=>[w("div",ja,[r(M,{type:"card"},{default:o(()=>[r(I,{label:"上证数据",name:"sse-json"},{default:o(()=>[x(t).sseData?(C(),W(me,{key:0,data:x(t).sseData,title:"上证数据"},null,8,["data"])):(C(),W(D,{key:1,description:"暂无数据"}))]),_:1}),r(I,{label:"深证数据",name:"szse-json"},{default:o(()=>[x(t).szseData?(C(),W(me,{key:0,data:x(t).szseData,title:"深证数据"},null,8,["data"])):(C(),W(D,{key:1,description:"暂无数据"}))]),_:1}),r(I,{label:"涨停数据",name:"limitup-json"},{default:o(()=>[x(t).limitUpData?(C(),W(me,{key:0,data:x(t).limitUpData,title:"涨停数据"},null,8,["data"])):(C(),W(D,{key:1,description:"暂无数据"}))]),_:1}),r(I,{label:"跌停数据",name:"limitdown-json"},{default:o(()=>[x(t).limitDownData?(C(),W(me,{key:0,data:x(t).limitDownData,title:"跌停数据"},null,8,["data"])):(C(),W(D,{key:1,description:"暂无数据"}))]),_:1}),r(I,{label:"指数数据",name:"indices-json"},{default:o(()=>[x(t).indicesData?(C(),W(me,{key:0,data:x(t).indicesData,title:"指数数据"},null,8,["data"])):(C(),W(D,{key:1,description:"暂无数据"}))]),_:1})]),_:1})])]),_:1},8,["modelValue","fullscreen"])])}}}),Pa=he(za,[["__scopeId","data-v-851df5be"]]),Ba={class:"data-view"},Va=fe({__name:"DataView",setup(h){return(t,e)=>(C(),Q("div",Ba,[r(Pa)]))}}),Wa=he(Va,[["__scopeId","data-v-09d15a13"]]);export{Wa as default};
